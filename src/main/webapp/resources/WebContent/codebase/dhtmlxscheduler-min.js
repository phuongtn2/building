function dtmlXMLLoaderObject(a,b,c,d){return this.xmlDoc="",this.async="undefined"!=typeof c?c:!0,this.onloadAction=a||null,this.mainObject=b||null,this.waitCall=null,this.rSeed=d||!1,this}function callerFunction(a,b){return this.handler=function(c){return c||(c=window.event),a(c,b),!0},this.handler}function getAbsoluteLeft(a){return getOffset(a).left}function getAbsoluteTop(a){return getOffset(a).top}function getOffsetSum(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop),c+=parseInt(a.offsetLeft),a=a.offsetParent;return{top:b,left:c}}function getOffsetRect(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}}function getOffset(a){return a.getBoundingClientRect?getOffsetRect(a):getOffsetSum(a)}function convertStringToBoolean(a){switch("string"==typeof a&&(a=a.toLowerCase()),a){case"1":case"true":case"yes":case"y":case 1:case!0:return!0;default:return!1}}function getUrlSymbol(a){return-1!=a.indexOf("?")?"&":"?"}function dhtmlDragAndDropObject(){return window.dhtmlDragAndDrop?window.dhtmlDragAndDrop:(this.lastLanding=0,this.dragNode=0,this.dragStartNode=0,this.dragStartObject=0,this.tempDOMU=null,this.tempDOMM=null,this.waitDrag=0,window.dhtmlDragAndDrop=this,this)}function _dhtmlxError(){return this.catches||(this.catches=[]),this}function dhtmlXHeir(a,b){for(var c in b)"function"==typeof b[c]&&(a[c]=b[c]);return a}function dhtmlxEvent(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function dataProcessor(a){return this.serverProcessor=a,this.action_param="!nativeeditor_status",this.object=null,this.updatedRows=[],this.autoUpdate=!0,this.updateMode="cell",this._tMode="GET",this.post_delim="_",this._waitMode=0,this._in_progress={},this._invalid={},this.mandatoryFields=[],this.messages=[],this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"},this.enableUTFencoding(!0),dhtmlxEventable(this),this}window.dhtmlXScheduler=window.scheduler={version:"4.2.0"},window.dhtmlx||(dhtmlx=function(a){for(var b in a)dhtmlx[b]=a[b];return dhtmlx}),dhtmlx.extend_api=function(a,b,c){var d=window[a];d&&(window[a]=function(a){var c;if(a&&"object"==typeof a&&!a.tagName){c=d.apply(this,b._init?b._init(a):arguments);for(var e in dhtmlx)b[e]&&this[b[e]](dhtmlx[e]);for(var e in a)b[e]?this[b[e]](a[e]):0===e.indexOf("on")&&this.attachEvent(e,a[e])}else c=d.apply(this,arguments);return b._patch&&b._patch(this),c||this},window[a].prototype=d.prototype,c&&dhtmlXHeir(window[a].prototype,c))},dhtmlxAjax={get:function(a,b){var c=new dtmlXMLLoaderObject(!0);return c.async=arguments.length<3,c.waitCall=b,c.loadXML(a),c},post:function(a,b,c){var d=new dtmlXMLLoaderObject(!0);return d.async=arguments.length<4,d.waitCall=c,d.loadXML(a,!0,b),d},getSync:function(a){return this.get(a,null,!0)},postSync:function(a,b){return this.post(a,b,null,!0)}},dtmlXMLLoaderObject.count=0,dtmlXMLLoaderObject.prototype.waitLoadFunction=function(a){var b=!0;return this.check=function(){if(a&&a.onloadAction&&(!a.xmlDoc.readyState||4==a.xmlDoc.readyState)){if(!b)return;b=!1,dtmlXMLLoaderObject.count++,"function"==typeof a.onloadAction&&a.onloadAction(a.mainObject,null,null,null,a),a.waitCall&&(a.waitCall.call(this,a),a.waitCall=null)}},this.check},dtmlXMLLoaderObject.prototype.getXMLTopNode=function(a,b){var c;if(this.xmlDoc.responseXML){var d=this.xmlDoc.responseXML.getElementsByTagName(a);if(0===d.length&&-1!=a.indexOf(":"))var d=this.xmlDoc.responseXML.getElementsByTagName(a.split(":")[1]);c=d[0]}else c=this.xmlDoc.documentElement;if(c)return this._retry=!1,c;if(!this._retry&&_isIE){this._retry=!0;var b=this.xmlDoc;return this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),!0),this.getXMLTopNode(a,b)}return dhtmlxError.throwError("LoadXML","Incorrect XML",[b||this.xmlDoc,this.mainObject]),document.createElement("DIV")},dtmlXMLLoaderObject.prototype.loadXMLString=function(a,b){if(_isIE)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.onreadystatechange=function(){},this.xmlDoc.loadXML(a);else{var c=new DOMParser;this.xmlDoc=c.parseFromString(a,"text/xml")}b||(this.onloadAction&&this.onloadAction(this.mainObject,null,null,null,this),this.waitCall&&(this.waitCall(),this.waitCall=null))},dtmlXMLLoaderObject.prototype.loadXML=function(a,b,c,d){this.rSeed&&(a+=(-1!=a.indexOf("?")?"&":"?")+"a_dhx_rSeed="+(new Date).valueOf()),this.filePath=a,this.xmlDoc=!_isIE&&window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.async&&(this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this)),"string"==typeof b?this.xmlDoc.open(b,a,this.async):this.xmlDoc.open(b?"POST":"GET",a,this.async),_ghUser&&this.xmlDoc.setRequestHeader("AUTHORIZED_TOKEN",_ghUser.getAuthToken()),d?(this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")"),this.xmlDoc.setRequestHeader("Content-type","text/xml")):b&&this.xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xmlDoc.send(null||c),this.async||new this.waitLoadFunction(this)()},dtmlXMLLoaderObject.prototype.destructor=function(){return this._filterXPath=null,this._getAllNamedChilds=null,this._retry=null,this.async=null,this.rSeed=null,this.filePath=null,this.onloadAction=null,this.mainObject=null,this.xmlDoc=null,this.doXPath=null,this.doXPathOpera=null,this.doXSLTransToObject=null,this.doXSLTransToString=null,this.loadXML=null,this.loadXMLString=null,this.doSerialization=null,this.xmlNodeToJSON=null,this.getXMLTopNode=null,this.setXSLParamValue=null,null},dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(a){for(var b={},c=0;c<a.attributes.length;c++)b[a.attributes[c].name]=a.attributes[c].value;b._tagvalue=a.firstChild?a.firstChild.nodeValue:"";for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c].tagName;d&&(b[d]||(b[d]=[]),b[d].push(this.xmlNodeToJSON(a.childNodes[c])))}return b},dhtmlDragAndDropObject.prototype.removeDraggableItem=function(a){a.onmousedown=null,a.dragStarter=null,a.dragLanding=null},dhtmlDragAndDropObject.prototype.addDraggableItem=function(a,b){a.onmousedown=this.preCreateDragCopy,a.dragStarter=b,this.addDragLanding(a,b)},dhtmlDragAndDropObject.prototype.addDragLanding=function(a,b){a.dragLanding=b},dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(a){return!a&&!window.event||2!=(a||event).button?window.dhtmlDragAndDrop.waitDrag?(window.dhtmlDragAndDrop.waitDrag=0,document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU,document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM,!1):(window.dhtmlDragAndDrop.dragNode&&window.dhtmlDragAndDrop.stopDrag(a),window.dhtmlDragAndDrop.waitDrag=1,window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup,window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove,window.dhtmlDragAndDrop.dragStartNode=this,window.dhtmlDragAndDrop.dragStartObject=this.dragStarter,document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy,document.body.onmousemove=window.dhtmlDragAndDrop.callDrag,window.dhtmlDragAndDrop.downtime=(new Date).valueOf(),a&&a.preventDefault?(a.preventDefault(),!1):!1):void 0},dhtmlDragAndDropObject.prototype.callDrag=function(a){a||(a=window.event);var b=window.dhtmlDragAndDrop;if(!((new Date).valueOf()-b.downtime<100)){if(!b.dragNode){if(!b.waitDrag)return b.stopDrag(a,!0);if(b.dragNode=b.dragStartObject._createDragNode(b.dragStartNode,a),!b.dragNode)return b.stopDrag();b.dragNode.onselectstart=function(){return!1},b.gldragNode=b.dragNode,document.body.appendChild(b.dragNode),document.body.onmouseup=b.stopDrag,b.waitDrag=0,b.dragNode.pWindow=window,b.initFrameRoute()}if(b.dragNode.parentNode!=window.document.body&&b.gldragNode){var c=b.gldragNode;b.gldragNode.old&&(c=b.gldragNode.old),c.parentNode.removeChild(c);var d=b.dragNode.pWindow;if(c.pWindow&&c.pWindow.dhtmlDragAndDrop.lastLanding&&c.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(c.pWindow.dhtmlDragAndDrop.lastLanding),_isIE){var e=document.createElement("Div");e.innerHTML=b.dragNode.outerHTML,b.dragNode=e.childNodes[0]}else b.dragNode=b.dragNode.cloneNode(!0);b.dragNode.pWindow=window,b.gldragNode.old=b.dragNode,document.body.appendChild(b.dragNode),d.dhtmlDragAndDrop.dragNode=b.dragNode}b.dragNode.style.left=a.clientX+15+(b.fx?-1*b.fx:0)+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px",b.dragNode.style.top=a.clientY+3+(b.fy?-1*b.fy:0)+(document.body.scrollTop||document.documentElement.scrollTop)+"px";var f;f=a.srcElement?a.srcElement:a.target,b.checkLanding(f,a)}},dhtmlDragAndDropObject.prototype.calculateFramePosition=function(a){if(window.name){for(var b=parent.frames[window.name].frameElement.offsetParent,c=0,d=0;b;)c+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;if(parent.dhtmlDragAndDrop){var e=parent.dhtmlDragAndDrop.calculateFramePosition(1);c+=1*e.split("_")[0],d+=1*e.split("_")[1]}if(a)return c+"_"+d;this.fx=c,this.fy=d}return"0_0"},dhtmlDragAndDropObject.prototype.checkLanding=function(a,b){a&&a.dragLanding?(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding),this.lastLanding=a,this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,b.clientX,b.clientY,b),this.lastLanding_scr=_isIE?b.srcElement:b.target):a&&"BODY"!=a.tagName?this.checkLanding(a.parentNode,b):(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding,b.clientX,b.clientY,b),this.lastLanding=0,this._onNotFound&&this._onNotFound())},dhtmlDragAndDropObject.prototype.stopDrag=function(a,b){var c=window.dhtmlDragAndDrop;if(!b){c.stopFrameRoute();var d=c.lastLanding;c.lastLanding=null,d&&d.dragLanding._drag(c.dragStartNode,c.dragStartObject,d,_isIE?event.srcElement:a.target)}c.lastLanding=null,c.dragNode&&c.dragNode.parentNode==document.body&&c.dragNode.parentNode.removeChild(c.dragNode),c.dragNode=0,c.gldragNode=0,c.fx=0,c.fy=0,c.dragStartNode=0,c.dragStartObject=0,document.body.onmouseup=c.tempDOMU,document.body.onmousemove=c.tempDOMM,c.tempDOMU=null,c.tempDOMM=null,c.waitDrag=0},dhtmlDragAndDropObject.prototype.stopFrameRoute=function(a){a&&window.dhtmlDragAndDrop.stopDrag(1,1);for(var b=0;b<window.frames.length;b++)try{window.frames[b]!=a&&window.frames[b].dhtmlDragAndDrop&&window.frames[b].dhtmlDragAndDrop.stopFrameRoute(window)}catch(c){}try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=a&&parent.dhtmlDragAndDrop.stopFrameRoute(window)}catch(c){}},dhtmlDragAndDropObject.prototype.initFrameRoute=function(a,b){a&&(window.dhtmlDragAndDrop.preCreateDragCopy(),window.dhtmlDragAndDrop.dragStartNode=a.dhtmlDragAndDrop.dragStartNode,window.dhtmlDragAndDrop.dragStartObject=a.dhtmlDragAndDrop.dragStartObject,window.dhtmlDragAndDrop.dragNode=a.dhtmlDragAndDrop.dragNode,window.dhtmlDragAndDrop.gldragNode=a.dhtmlDragAndDrop.dragNode,window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag,window.waitDrag=0,!_isIE&&b&&(!_isFF||_FFrv<1.8)&&window.dhtmlDragAndDrop.calculateFramePosition());try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=a&&parent.dhtmlDragAndDrop.initFrameRoute(window)}catch(c){}for(var d=0;d<window.frames.length;d++)try{window.frames[d]!=a&&window.frames[d].dhtmlDragAndDrop&&window.frames[d].dhtmlDragAndDrop.initFrameRoute(window,!a||b?1:0)}catch(c){}},_isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1,-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,-1==navigator.appVersion.indexOf("MSIE 8.0")&&-1==navigator.appVersion.indexOf("MSIE 9.0")&&-1==navigator.appVersion.indexOf("MSIE 10.0")||"BackCompat"==document.compatMode||(_isIE=8)):"Netscape"==navigator.appName&&-1!=navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),dtmlXMLLoaderObject.prototype.doXPath=function(a,b,c,d){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(a,b);if(_isIE)return b||(b=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),b||dhtmlxError.throwError("LoadXML","Incorrect XML",[b||this.xmlDoc,this.mainObject]),c&&b.setProperty("SelectionNamespaces","xmlns:xsl='"+c+"'"),"single"==d?b.selectSingleNode(a):b.selectNodes(a)||new Array(0);var e=b;b||(b=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),b||dhtmlxError.throwError("LoadXML","Incorrect XML",[b||this.xmlDoc,this.mainObject]),-1!=b.nodeName.indexOf("document")?e=b:(e=b,b=b.ownerDocument);var f=XPathResult.ANY_TYPE;"single"==d&&(f=XPathResult.FIRST_ORDERED_NODE_TYPE);var g=[],h=b.evaluate(a,e,function(){return c},f,null);if(f==XPathResult.FIRST_ORDERED_NODE_TYPE)return h.singleNodeValue;for(var i=h.iterateNext();i;)g[g.length]=i,i=h.iterateNext();return g},_dhtmlxError.prototype.catchError=function(a,b){this.catches[a]=b},_dhtmlxError.prototype.throwError=function(a,b,c){return this.catches[a]?this.catches[a](a,b,c):this.catches.ALL?this.catches.ALL(a,b,c):(window.alert("Error type: "+arguments[0]+"\nDescription: "+arguments[1]),null)},window.dhtmlxError=new _dhtmlxError,dtmlXMLLoaderObject.prototype.doXPathOpera=function(a,b){var c=a.replace(/[\/]+/gi,"/").split("/"),d=null,e=1;if(!c.length)return[];if("."==c[0])d=[b];else{if(""!==c[0])return[];d=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(c[e].replace(/\[[^\]]*\]/g,"")),e++}for(e;e<c.length;e++)d=this._getAllNamedChilds(d,c[e]);return-1!=c[e-1].indexOf("[")&&(d=this._filterXPath(d,c[e-1])),d},dtmlXMLLoaderObject.prototype._filterXPath=function(a,b){for(var c=[],b=b.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,""),d=0;d<a.length;d++)a[d].getAttribute(b)&&(c[c.length]=a[d]);return c},dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(a,b){var c=[];_isKHTML&&(b=b.toUpperCase());for(var d=0;d<a.length;d++)for(var e=0;e<a[d].childNodes.length;e++)_isKHTML?a[d].childNodes[e].tagName&&a[d].childNodes[e].tagName.toUpperCase()==b&&(c[c.length]=a[d].childNodes[e]):a[d].childNodes[e].tagName==b&&(c[c.length]=a[d].childNodes[e]);return c},dtmlXMLLoaderObject.prototype.xslDoc=null,dtmlXMLLoaderObject.prototype.setXSLParamValue=function(a,b,c){c||(c=this.xslDoc),c.responseXML&&(c=c.responseXML);var d=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+a+"']",c,"http://www.w3.org/1999/XSL/Transform","single");d&&(d.firstChild.nodeValue=b)},dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(a,b){a||(a=this.xslDoc),a.responseXML&&(a=a.responseXML),b||(b=this.xmlDoc),b.responseXML&&(b=b.responseXML);var c;if(_isIE){c=new ActiveXObject("Msxml2.DOMDocument.3.0");try{b.transformNodeToObject(a,c)}catch(d){c=b.transformNode(a)}}else this.XSLProcessor||(this.XSLProcessor=new XSLTProcessor,this.XSLProcessor.importStylesheet(a)),c=this.XSLProcessor.transformToDocument(b);return c},dtmlXMLLoaderObject.prototype.doXSLTransToString=function(a,b){var c=this.doXSLTransToObject(a,b);return"string"==typeof c?c:this.doSerialization(c)},dtmlXMLLoaderObject.prototype.doSerialization=function(a){if(a||(a=this.xmlDoc),a.responseXML&&(a=a.responseXML),_isIE)return a.xml;var b=new XMLSerializer;return b.serializeToString(a)},dhtmlxEventable=function(obj){obj.attachEvent=function(a,b,c){return a="ev_"+a.toLowerCase(),this[a]||(this[a]=new this.eventCatcher(c||this)),a+":"+this[a].addEvent(b)},obj.callEvent=function(a,b){return a="ev_"+a.toLowerCase(),this[a]?this[a].apply(this,b):!0},obj.checkEvent=function(a){return!!this["ev_"+a.toLowerCase()]},obj.eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var a=!0,b=0;b<dhx_catch.length;b++)if(dhx_catch[b]){var c=dhx_catch[b].apply(obj,arguments);a=a&&c}return a};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),ev?dhx_catch.push(ev)-1:!1},z.removeEvent=function(a){dhx_catch[a]=null},z},obj.detachEvent=function(a){if(a){var b=a.split(":");this[b[0]].removeEvent(b[1])}},obj.detachAllEvents=function(){for(var a in this)0===a.indexOf("ev_")&&(this.detachEvent(a),this[a]=null)},obj=null},window.dhtmlx||(window.dhtmlx={}),function(){function a(a,b){var d=a.callback;c(!1),a.box.parentNode.removeChild(a.box),m=a.box=null,d&&d(b)}function b(b){if(m){b=b||event;var c=b.which||event.keyCode;return dhtmlx.message.keyboard&&((13==c||32==c)&&a(m,!0),27==c&&a(m,!1)),b.preventDefault&&b.preventDefault(),!(b.cancelBubble=!0)}}function c(a){c.cover||(c.cover=document.createElement("DIV"),c.cover.onkeydown=b,c.cover.className="dhx_modal_cover",document.body.appendChild(c.cover));document.body.scrollHeight;c.cover.style.display=a?"inline-block":"none"}function d(a,b,c){var d=c?c:a||"",e="dhtmlx_"+d.toLowerCase().replace(/ /g,"_")+"_button";return"<div class='dhtmlx_popup_button "+e+"' result='"+b+"' ><div>"+a+"</div></div>"}function e(a){n.area||(n.area=document.createElement("DIV"),n.area.className="dhtmlx_message_area",n.area.style[n.position]="5px",document.body.appendChild(n.area)),n.hide(a.id);var b=document.createElement("DIV");return b.innerHTML="<div>"+a.text+"</div>",b.className="dhtmlx-info dhtmlx-"+a.type,b.onclick=function(){n.hide(a.id),a=null},"bottom"==n.position&&n.area.firstChild?n.area.insertBefore(b,n.area.firstChild):n.area.appendChild(b),a.expire>0&&(n.timers[a.id]=window.setTimeout(function(){n.hide(a.id)},a.expire)),n.pull[a.id]=b,b=null,a.id}function f(b,c,e){var f=document.createElement("DIV");f.className=" dhtmlx_modal_box dhtmlx-"+b.type,f.setAttribute("dhxbox",1);var g="";if(b.width&&(f.style.width=b.width),b.height&&(f.style.height=b.height),b.title&&(g+='<div class="dhtmlx_popup_title">'+b.title+"</div>"),g+='<div class="dhtmlx_popup_text"><span>'+(b.content?"":b.text)+'</span></div><div  class="dhtmlx_popup_controls">',c){var h=b.ok||scheduler.locale.labels.message_ok;void 0===h&&(h="OK"),g+=d(h,!0,"ok")}if(e){var i=b.cancel||scheduler.locale.labels.message_cancel;void 0===i&&(i="Cancel"),g+=d(i,!1,"cancel")}if(b.buttons)for(var j=0;j<b.buttons.length;j++)g+=d(b.buttons[j],j);if(g+="</div>",f.innerHTML=g,b.content){var k=b.content;"string"==typeof k&&(k=document.getElementById(k)),"none"==k.style.display&&(k.style.display=""),f.childNodes[b.title?1:0].appendChild(k)}return f.onclick=function(c){c=c||event;var d=c.target||c.srcElement;if(d.className||(d=d.parentNode),"dhtmlx_popup_button"==d.className.split(" ")[0]){var e=d.getAttribute("result");e="true"==e||("false"==e?!1:e),a(b,e)}},b.box=f,(c||e)&&(m=b),f}function g(a,d,e){var g=a.tagName?a:f(a,d,e);a.hidden||c(!0),document.body.appendChild(g);var h=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-g.offsetWidth)/2)),i=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-g.offsetHeight)/2));return g.style.top="top"==a.position?"-3px":i+"px",g.style.left=h+"px",g.onkeydown=b,g.focus(),a.hidden&&dhtmlx.modalbox.hide(g),g}function h(a){return g(a,!0,!1)}function i(a){return g(a,!0,!0)}function j(a){return g(a)}function k(a,b,c){return"object"!=typeof a&&("function"==typeof b&&(c=b,b=""),a={text:a,type:b,callback:c}),a}function l(a,b,c,d){return"object"!=typeof a&&(a={text:a,type:b,expire:c,id:d}),a.id=a.id||n.uid(),a.expire=a.expire||n.expire,a}var m=null;document.attachEvent?document.attachEvent("onkeydown",b):document.addEventListener("keydown",b,!0),dhtmlx.alert=function(){var a=k.apply(this,arguments);return a.type=a.type||"confirm",h(a)},dhtmlx.confirm=function(){var a=k.apply(this,arguments);return a.type=a.type||"alert",i(a)},dhtmlx.modalbox=function(){var a=k.apply(this,arguments);return a.type=a.type||"alert",j(a)},dhtmlx.modalbox.hide=function(a){for(;a&&a.getAttribute&&!a.getAttribute("dhxbox");)a=a.parentNode;a&&(a.parentNode.removeChild(a),c(!1))};var n=dhtmlx.message=function(a){a=l.apply(this,arguments),a.type=a.type||"info";var b=a.type.split("-")[0];switch(b){case"alert":return h(a);case"confirm":return i(a);case"modalbox":return j(a);default:return e(a)}};n.seed=(new Date).valueOf(),n.uid=function(){return n.seed++},n.expire=4e3,n.keyboard=!0,n.position="top",n.pull={},n.timers={},n.hideAll=function(){for(var a in n.pull)n.hide(a)},n.hide=function(a){var b=n.pull[a];b&&b.parentNode&&(window.setTimeout(function(){b.parentNode.removeChild(b),b=null},2e3),b.className+=" hidden",n.timers[a]&&window.clearTimeout(n.timers[a]),delete n.pull[a])}}(),dataProcessor.prototype={setTransactionMode:function(a,b){this._tMode=a,this._tSend=b,"REST"==a&&(this._tSend=!1,this._endnm=!0)},escape:function(a){return this._utf?encodeURIComponent(a):escape(a)},enableUTFencoding:function(a){this._utf=convertStringToBoolean(a)},setDataColumns:function(a){this._columns="string"==typeof a?a.split(","):a},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(a){this._endnm=convertStringToBoolean(a)},enablePartialDataSend:function(a){this._changed=convertStringToBoolean(a)},setUpdateMode:function(a,b){this.autoUpdate="cell"==a,this.updateMode=a,this.dnd=b},ignore:function(a,b){this._silent_mode=!0,a.call(b||window),this._silent_mode=!1},setUpdated:function(a,b,c){if(!this._silent_mode){var d=this.findRow(a);c=c||"updated";var e=this.obj.getUserData(a,this.action_param);e&&"updated"==c&&(c=e),b?(this.set_invalid(a,!1),this.updatedRows[d]=a,this.obj.setUserData(a,this.action_param,c),this._in_progress[a]&&(this._in_progress[a]="wait")):this.is_invalid(a)||(this.updatedRows.splice(d,1),this.obj.setUserData(a,this.action_param,"")),b||this._clearUpdateFlag(a),this.markRow(a,b,c),b&&this.autoUpdate&&this.sendData(a)}},_clearUpdateFlag:function(){},markRow:function(a,b,c){var d="",e=this.is_invalid(a);if(e&&(d=this.styles[e],b=!0),this.callEvent("onRowMark",[a,b,c,e])&&(d=this.styles[b?c:"clear"]+d,this.obj[this._methods[0]](a,d),e&&e.details)){d+=this.styles[e+"_cell"];for(var f=0;f<e.details.length;f++)e.details[f]&&this.obj[this._methods[1]](a,f,d)}},getState:function(a){return this.obj.getUserData(a,this.action_param)},is_invalid:function(a){return this._invalid[a]},set_invalid:function(a,b,c){c&&(b={value:b,details:c,toString:function(){return this.value.toString()}}),this._invalid[a]=b},checkBeforeUpdate:function(){return!0},sendData:function(a){return!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2?(this.obj.editStop&&this.obj.editStop(),"undefined"==typeof a||this._tSend?this.sendAllData():this._in_progress[a]?!1:(this.messages=[],!this.checkBeforeUpdate(a)&&this.callEvent("onValidationError",[a,this.messages])?!1:void this._beforeSendData(this._getRowData(a),a))):void 0},_beforeSendData:function(a,b){return this.callEvent("onBeforeUpdate",[b,this.getState(b),a])?void this._sendData(a,b):!1},serialize:function(a,b){if("string"==typeof a)return a;if("undefined"!=typeof b)return this.serialize_one(a,"");var c=[],d=[];for(var e in a)a.hasOwnProperty(e)&&(c.push(this.serialize_one(a[e],e+this.post_delim)),d.push(e));return c.push("ids="+this.escape(d.join(","))),dhtmlx.security_key&&c.push("dhx_security="+dhtmlx.security_key),c.join("&")},serialize_one:function(a,b){if("string"==typeof a)return a;var c=[];for(var d in a)if(a.hasOwnProperty(d)){if(("id"==d||d==this.action_param)&&"REST"==this._tMode)continue;c.push(this.escape((b||"")+d)+"="+this.escape(a[d]))}return c.join("&")},_sendData:function(a,b){if(a){if(!this.callEvent("onBeforeDataSending",b?[b,this.getState(b),a]:[null,null,a]))return!1;b&&(this._in_progress[b]=(new Date).valueOf());var c=new dtmlXMLLoaderObject(function(c,d,e,f,g){var h=[];if(b)h.push(b);else if(a)for(var i in a)h.push(i);return c.afterUpdate(c,g,h)},this,!0),d=this.serverProcessor+(this._user?getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");if("GET"==this._tMode)c.loadXML(d+(-1!=d.indexOf("?")?"&":"?")+this.serialize(a,b));else if("POST"==this._tMode)c.loadXML(d,!0,this.serialize(a,b));else if("REST"==this._tMode){var e=this.getState(b),f=d.replace(/(\&|\?)editing\=true/,"");"inserted"==e?c.loadXML(f+b,"POST",this.serialize(a,b)):"deleted"==e?c.loadXML(f+b,"DELETE",""):c.loadXML(f+b,"PUT",this.serialize(a,b))}this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var a=!0,b=0;b<this.updatedRows.length;b++)a&=this.checkBeforeUpdate(this.updatedRows[b]);if(!a&&!this.callEvent("onValidationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());else for(var b=0;b<this.updatedRows.length;b++)if(!this._in_progress[this.updatedRows[b]]){if(this.is_invalid(this.updatedRows[b]))continue;if(this._beforeSendData(this._getRowData(this.updatedRows[b]),this.updatedRows[b]),this._waitMode&&("tree"==this.obj.mytype||this.obj._h2))return}}},_getAllData:function(){for(var a={},b=!1,c=0;c<this.updatedRows.length;c++){var d=this.updatedRows[c];this._in_progress[d]||this.is_invalid(d)||this.callEvent("onBeforeUpdate",[d,this.getState(d),this._getRowData(d)])&&(a[d]=this._getRowData(d,d+this.post_delim),b=!0,this._in_progress[d]=(new Date).valueOf())}return b?a:null},setVerificator:function(a,b){this.mandatoryFields[a]=b||function(a){return""!==a}},clearVerificator:function(a){this.mandatoryFields[a]=!1},findRow:function(a){var b=0;for(b=0;b<this.updatedRows.length&&a!=this.updatedRows[b];b++);return b},defineAction:function(a,b){this._uActions||(this._uActions=[]),this._uActions[a]=b},afterUpdateCallback:function(a,b,c,d){var e=a,f="error"!=c&&"invalid"!=c;if(f||this.set_invalid(a,c),this._uActions&&this._uActions[c]&&!this._uActions[c](d))return delete this._in_progress[e];"wait"!=this._in_progress[e]&&this.setUpdated(a,!1);var g=a;switch(c){case"inserted":case"insert":b!=a&&(this.obj[this._methods[2]](a,b),a=b);break;case"delete":case"deleted":return this.obj.setUserData(a,this.action_param,"true_deleted"),this.obj[this._methods[3]](a),delete this._in_progress[e],this.callEvent("onAfterUpdate",[a,c,b,d])}"wait"!=this._in_progress[e]?(f&&this.obj.setUserData(a,this.action_param,""),delete this._in_progress[e]):(delete this._in_progress[e],this.setUpdated(b,!0,this.obj.getUserData(a,this.action_param))),this.callEvent("onAfterUpdate",[g,c,b,d])},afterUpdate:function(a,b,c){if(window.JSON)try{var d=JSON.parse(b.xmlDoc.responseText),e=d.action||this.getState(c)||"updated",f=d.sid||c[0],g=d.tid||c[0];return a.afterUpdateCallback(f,g,e,d),void a.finalizeUpdate()}catch(h){}if(b.getXMLTopNode("data"),!b.xmlDoc.responseXML)return this.obj&&this.obj.callEvent&&this.obj.callEvent("onSaveError",[c,b.xmlDoc]),this.cleanUpdate(c);var i=b.doXPath("//data/action");if(!i.length)return this.cleanUpdate(c);for(var j=0;j<i.length;j++){var k=i[j],e=k.getAttribute("type"),f=k.getAttribute("sid"),g=k.getAttribute("tid");a.afterUpdateCallback(f,g,e,k)}a.finalizeUpdate()},cleanUpdate:function(a){if(a)for(var b=0;b<a.length;b++)delete this._in_progress[a[b]]},finalizeUpdate:function(){this._waitMode&&this._waitMode--,("tree"==this.obj.mytype||this.obj._h2)&&this.updatedRows.length&&this.sendData(),this.callEvent("onAfterUpdateFinish",[]),this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(a){this.obj=a,this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(a){this.attachEvent("onAfterUpdate",a)},enableDebug:function(){},setOnBeforeUpdateHandler:function(a){this.attachEvent("onBeforeDataSending",a)},setAutoUpdate:function(a,b){a=a||2e3,this._user=b||(new Date).valueOf(),this._need_update=!1,this._loader=null,this._update_busy=!1,this.attachEvent("onAfterUpdate",function(a,b,c,d){this.afterAutoUpdate(a,b,c,d)}),this.attachEvent("onFullSync",function(){this.fullSync()});var c=this;window.setInterval(function(){c.loadUpdate()},a)},afterAutoUpdate:function(a,b){return"collision"==b?(this._need_update=!0,!1):!0},fullSync:function(){return this._need_update&&(this._need_update=!1,this.loadUpdate()),!0},getUpdates:function(a,b){return this._update_busy?!1:(this._update_busy=!0,this._loader=this._loader||new dtmlXMLLoaderObject(!0),this._loader.async=!0,this._loader.waitCall=b,void this._loader.loadXML(a))},_v:function(a){return a.firstChild?a.firstChild.nodeValue:""},_a:function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this._v(a[c]);return b},loadUpdate:function(){var a=this,b=this.obj.getUserData(0,"version"),c=this.serverProcessor+getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+b].join("&");c=c.replace("editing=true&",""),this.getUpdates(c,function(){var b=a._loader.doXPath("//userdata");a.obj.setUserData(0,"version",a._v(b[0]));var c=a._loader.doXPath("//update");if(c.length){a._silent_mode=!0;for(var d=0;d<c.length;d++){var e=c[d].getAttribute("status"),f=c[d].getAttribute("id"),g=c[d].getAttribute("parent");switch(e){case"inserted":a.callEvent("insertCallback",[c[d],f,g]);break;case"updated":a.callEvent("updateCallback",[c[d],f,g]);break;case"deleted":a.callEvent("deleteCallback",[c[d],f,g])}}a._silent_mode=!1}a._update_busy=!1,a=null})}},window.dataProcessor&&!dataProcessor.prototype.init_original&&(dataProcessor.prototype.init_original=dataProcessor.prototype.init,dataProcessor.prototype.init=function(a){this.init_original(a),a._dataprocessor=this,this.setTransactionMode("POST",!0),this.serverProcessor+=(-1!=this.serverProcessor.indexOf("?")?"&":"?")+"editing=true"}),dhtmlxError.catchError("LoadXML",function(a,b,c){var d=c[0].responseText;switch(scheduler.config.ajax_error){case"alert":window.alert(d);break;case"console":window.console.log(d)}}),dhtmlxEventable(scheduler),scheduler._detachDomEvent=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)},scheduler._init_once=function(){function a(){return{w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight}}function b(a,b){return a.w==b.w&&a.h==b.h}var c=a();dhtmlxEvent(window,"resize",function(){var d=a();b(c,d)||(window.clearTimeout(scheduler._resize_timer),scheduler._resize_timer=window.setTimeout(function(){scheduler.callEvent("onSchedulerResize",[])&&(scheduler.update_view(),scheduler.callEvent("onAfterSchedulerResize",[]))},100)),c=d}),scheduler._init_once=function(){}},scheduler.init=function(a,b,c){b=b||scheduler._currentDate(),c=c||"week",this._obj&&this.unset_actions(),this._obj="string"==typeof a?document.getElementById(a):a,this._skin_init&&scheduler._skin_init(),scheduler.date.init(),this._els=[],this._scroll=!0,this._quirks=_isIE&&"BackCompat"==document.compatMode,this._quirks7=_isIE&&-1==navigator.appVersion.indexOf("MSIE 8"),this.get_elements(),this.init_templates(),this.set_actions(),this._init_once(),this._init_touch_events(),this.set_sizes(),scheduler.callEvent("onSchedulerReady",[]),this.setCurrentView(b,c)},scheduler.xy={min_event_height:40,scale_width:50,scroll_width:18,scale_height:20,month_scale_height:20,menu_width:25,margin_top:0,margin_left:0,editor_width:140,month_head_height:22},scheduler.keys={edit_save:13,edit_cancel:27},scheduler.set_sizes=function(){var a=this._x=this._obj.clientWidth-this.xy.margin_left,b=this._y=this._obj.clientHeight-this.xy.margin_top,c=this._table_view?0:this.xy.scale_width+this.xy.scroll_width,d=this._table_view?-1:this.xy.scale_width;this.set_xy(this._els.dhx_cal_navline[0],a,this.xy.nav_height,0,0),this.set_xy(this._els.dhx_cal_header[0],a-c,this.xy.scale_height,d,this.xy.nav_height+(this._quirks?-1:1));
var e=this._els.dhx_cal_navline[0].offsetHeight;e>0&&(this.xy.nav_height=e);var f=this.xy.scale_height+this.xy.nav_height+(this._quirks?-2:0);this.set_xy(this._els.dhx_cal_data[0],a,b-(f+2),0,f+2)},scheduler.set_xy=function(a,b,c,d,e){a.style.width=Math.max(0,b)+"px",a.style.height=Math.max(0,c)+"px",arguments.length>3&&(a.style.left=d+"px",a.style.top=e+"px")},scheduler.get_elements=function(){for(var a=this._obj.getElementsByTagName("DIV"),b=0;b<a.length;b++){var c=a[b].className||"",d=a[b].getAttribute("name")||"";c&&(c=c.split(" ")[0]),this._els[c]||(this._els[c]=[]),this._els[c].push(a[b]);var e=scheduler.locale.labels[d||c];"string"!=typeof e&&d&&!a[b].innerHTML&&(e=d.split("_")[0]),e&&(a[b].innerHTML=e)}},scheduler.unset_actions=function(){for(var a in this._els)if(this._click[a])for(var b=0;b<this._els[a].length;b++)this._els[a][b].onclick=null;this._obj.onselectstart=null,this._obj.onmousemove=null,this._obj.onmousedown=null,this._obj.onmouseup=null,this._obj.ondblclick=null,this._obj.oncontextmenu=null},scheduler.set_actions=function(){for(var a in this._els)if(this._click[a])for(var b=0;b<this._els[a].length;b++)this._els[a][b].onclick=scheduler._click[a];this._obj.onselectstart=function(){return!1},this._obj.onmousemove=function(a){scheduler._temp_touch_block||scheduler._on_mouse_move(a||event)},this._obj.onmousedown=function(a){scheduler._ignore_next_click||scheduler._on_mouse_down(a||event)},this._obj.onmouseup=function(a){scheduler._ignore_next_click||scheduler._on_mouse_up(a||event)},this._obj.ondblclick=function(a){scheduler._on_dbl_click(a||event)},this._obj.oncontextmenu=function(a){var b=a||event,c=b.target||b.srcElement,d=scheduler.callEvent("onContextMenu",[scheduler._locate_event(c),b]);return d}},scheduler.select=function(a){this._select_id!=a&&(scheduler._close_not_saved(),this.editStop(!1),this.unselect(),this._select_id=a,this.updateEvent(a))},scheduler.unselect=function(a){if(!a||a==this._select_id){var b=this._select_id;this._select_id=null,b&&this.getEvent(b)&&this.updateEvent(b)}},scheduler.getState=function(){return{mode:this._mode,date:new Date(this._date),min_date:new Date(this._min_date),max_date:new Date(this._max_date),editor_id:this._edit_id,lightbox_id:this._lightbox_id,new_event:this._new_event,select_id:this._select_id,expanded:this.expanded,drag_id:this._drag_id,drag_mode:this._drag_mode}},scheduler._click={dhx_cal_data:function(a){if(scheduler._ignore_next_click)return a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,scheduler._ignore_next_click=!1,!1;var b=a?a.target:event.srcElement,c=scheduler._locate_event(b);if(a=a||event,c){if(!scheduler.callEvent("onClick",[c,a])||scheduler.config.readonly)return}else scheduler.callEvent("onEmptyClick",[scheduler.getActionData(a).date,a]);if(c&&scheduler.config.select){scheduler.select(c);var d=b.className;-1!=d.indexOf("_icon")&&scheduler._click.buttons[d.split(" ")[1].replace("icon_","")](c)}else scheduler._close_not_saved(),scheduler.unselect()},dhx_cal_prev_button:function(){scheduler._click.dhx_cal_next_button(0,-1)},dhx_cal_next_button:function(a,b){scheduler.setCurrentView(scheduler.date.add(scheduler.date[scheduler._mode+"_start"](scheduler._date),b||1,scheduler._mode))},dhx_cal_today_button:function(){scheduler.callEvent("onBeforeTodayDisplayed",[])&&scheduler.setCurrentView(scheduler._currentDate())},dhx_cal_tab:function(){var a=this.getAttribute("name"),b=a.substring(0,a.search("_tab"));scheduler.setCurrentView(scheduler._date,b)},buttons:{"delete":function(a){var b=scheduler.locale.labels.confirm_deleting;scheduler._dhtmlx_confirm(b,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(a)})},edit:function(a){scheduler.edit(a)},save:function(){scheduler.editStop(!0)},details:function(a){scheduler.showLightbox(a)},cancel:function(){scheduler.editStop(!1)}}},scheduler._dhtmlx_confirm=function(a,b,c){if(!a)return c();var d={text:a};b&&(d.title=b),c&&(d.callback=function(a){a&&c()}),dhtmlx.confirm(d)},scheduler.addEventNow=function(a,b,c){var d={};a&&null!==a.constructor.toString().match(/object/i)&&(d=a,a=null);var e=6e4*(this.config.event_duration||this.config.time_step);a||(a=d.start_date||Math.round(scheduler._currentDate().valueOf()/e)*e);var f=new Date(a);if(!b){var g=this.config.first_hour;g>f.getHours()&&(f.setHours(g),a=f.valueOf()),b=a.valueOf()+e}var h=new Date(b);f.valueOf()==h.valueOf()&&h.setTime(h.valueOf()+e),d.start_date=d.start_date||f,d.end_date=d.end_date||h,d.text=d.text||this.locale.labels.new_event,d.id=this._drag_id=this.uid(),this._drag_mode="new-size",this._loading=!0,this.addEvent(d),this.callEvent("onEventCreated",[this._drag_id,c]),this._loading=!1,this._drag_event={},this._on_mouse_up(c)},scheduler._on_dbl_click=function(a,b){if(b=b||a.target||a.srcElement,!this.config.readonly){var c=(b.className||"").split(" ")[0];switch(c){case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_wa_day_data":if(!scheduler.config.dblclick_create)break;this.addEventNow(this.getActionData(a).date,null,a);break;case"dhx_cal_event":case"dhx_wa_ev_body":case"dhx_agenda_line":case"dhx_grid_event":case"dhx_cal_event_line":case"dhx_cal_event_clear":var d=this._locate_event(b);if(!this.callEvent("onDblClick",[d,a]))return;this.config.details_on_dblclick||this._table_view||!this.getEvent(d)._timed||!this.config.select?this.showLightbox(d):this.edit(d);break;case"dhx_time_block":case"dhx_cal_container":return;default:var e=this["dblclick_"+c];if(e)e.call(this,a);else if(b.parentNode&&b!=this)return scheduler._on_dbl_click(a,b.parentNode)}}},scheduler._get_column_index=function(a){var b=0;if(this._cols){for(var c=0,d=0;d<this._cols.length&&!c;d++)c=this._cols[d];if(b=c?a/c:0,this._ignores)for(var d=0;b>=d;d++)this._ignores[d]&&b++}return b},scheduler._week_indexes_from_pos=function(a){if(this._cols){var b=this._get_column_index(a.x);return a.x=Math.min(this._cols.length-1,Math.max(0,Math.ceil(b)-1)),a.y=Math.max(0,Math.ceil(60*a.y/(this.config.time_step*this.config.hour_size_px))-1)+this.config.first_hour*(60/this.config.time_step),a}return a},scheduler._mouse_coords=function(a){var b,c=document.body,d=document.documentElement;b=_isIE||!a.pageX&&!a.pageY?{x:a.clientX+(c.scrollLeft||d.scrollLeft||0)-c.clientLeft,y:a.clientY+(c.scrollTop||d.scrollTop||0)-c.clientTop}:{x:a.pageX,y:a.pageY},b.x-=getAbsoluteLeft(this._obj)+(this._table_view?0:this.xy.scale_width),b.y-=getAbsoluteTop(this._obj)+this.xy.nav_height+(this._dy_shift||0)+this.xy.scale_height-this._els.dhx_cal_data[0].scrollTop,b.ev=a;var e=this["mouse_"+this._mode];if(e)return e.call(this,b);if(this._table_view){var f=this._get_column_index(b.x);if(!this._cols||!this._colsS)return b;var g=0;for(g=1;g<this._colsS.heights.length&&!(this._colsS.heights[g]>b.y);g++);b.y=Math.ceil(24*(Math.max(0,f)+7*Math.max(0,g-1))*60/this.config.time_step),(scheduler._drag_mode||"month"==this._mode)&&(b.y=24*(Math.max(0,Math.ceil(f)-1)+7*Math.max(0,g-1))*60/this.config.time_step),"move"==this._drag_mode&&scheduler._ignores_detected&&scheduler.config.preserve_length&&(b._ignores=!0,this._drag_event._event_length||(this._drag_event._event_length=this._get_real_event_length(this._drag_event.start_date,this._drag_event.end_date,{x_step:1,x_unit:"day"}))),b.x=0}else b=this._week_indexes_from_pos(b);return b},scheduler._close_not_saved=function(){if((new Date).valueOf()-(scheduler._new_event||0)>500&&scheduler._edit_id){var a=scheduler.locale.labels.confirm_closing;scheduler._dhtmlx_confirm(a,scheduler.locale.labels.title_confirm_closing,function(){scheduler.editStop(scheduler.config.positive_closing)})}},scheduler._correct_shift=function(a,b){return a-=6e4*(new Date(scheduler._min_date).getTimezoneOffset()-new Date(a).getTimezoneOffset())*(b?-1:1)},scheduler._on_mouse_move=function(a){if(this._drag_mode){var b=this._mouse_coords(a);if(!this._drag_pos||b.force_redraw||this._drag_pos.x!=b.x||this._drag_pos.y!=b.y){var c,d;if(this._edit_id!=this._drag_id&&this._close_not_saved(),this._drag_pos=b,"create"==this._drag_mode){if(this._close_not_saved(),this.unselect(this._select_id),this._loading=!0,c=this._get_date_from_pos(b).valueOf(),!this._drag_start){var e=this.callEvent("onBeforeEventCreated",[a,this._drag_id]);if(!e)return;return void(this._drag_start=c)}d=c,d==this._drag_start;var f=new Date(this._drag_start),g=new Date(d);"day"!=this._mode&&"week"!=this._mode||f.getHours()!=g.getHours()||f.getMinutes()!=g.getMinutes()||(g=new Date(this._drag_start+1e3)),this._drag_id=this.uid(),this.addEvent(f,g,this.locale.labels.new_event,this._drag_id,b.fields),this.callEvent("onEventCreated",[this._drag_id,a]),this._loading=!1,this._drag_mode="new-size"}var h,i=this.getEvent(this._drag_id);if("move"==this._drag_mode)c=this._min_date.valueOf()+6e4*(b.y*this.config.time_step+24*b.x*60-(scheduler._move_pos_shift||0)),!b.custom&&this._table_view&&(c+=1e3*this.date.time_part(i.start_date)),c=this._correct_shift(c),b._ignores&&this.config.preserve_length&&this._table_view?(this.matrix&&(h=this.matrix[this._mode]),h=h||{x_step:1,x_unit:"day"},d=1*c+this._get_fictional_event_length(c,this._drag_event._event_length,h)):d=i.end_date.valueOf()-(i.start_date.valueOf()-c);else{if(c=i.start_date.valueOf(),d=i.end_date.valueOf(),this._table_view){var j=this._min_date.valueOf()+b.y*this.config.time_step*6e4+(b.custom?0:864e5);if("month"==this._mode)if(j=this._correct_shift(j,!1),this._drag_from_start){var k=864e5;j<=scheduler.date.date_part(new Date(d+k-1)).valueOf()&&(c=j-k)}else d=j;else b.resize_from_start?c=j:d=j}else d=this.date.date_part(new Date(i.end_date.valueOf()-1)).valueOf()+b.y*this.config.time_step*6e4,this._els.dhx_cal_data[0].style.cursor="s-resize",("week"==this._mode||"day"==this._mode)&&(d=this._correct_shift(d));if("new-size"==this._drag_mode)if(d<=this._drag_start){var l=b.shift||(this._table_view&&!b.custom?864e5:0);c=d-(b.shift?0:l),d=this._drag_start+(l||6e4*this.config.time_step)}else c=this._drag_start;else c>=d&&(d=c+6e4*this.config.time_step)}var m=new Date(d-1),n=new Date(c);if(scheduler.config.limit_drag_out&&(+n<+scheduler._min_date||+d>+scheduler._max_date)){var o=d-n;+n<+scheduler._min_date?(n=new Date(scheduler._min_date),d=new Date(+n+o)):(d=new Date(scheduler._max_date),n=new Date(+d-o));var m=new Date(d-1)}if(!this._table_view&&!scheduler.config.all_timed&&(b.x!=this._get_event_sday({start_date:new Date(d),end_date:new Date(d)})||new Date(d).getHours()>=this.config.last_hour)){var o=d-n,k=this._min_date.valueOf()+24*b.x*60*6e4;d=scheduler.date.date_part(new Date(k)),d.setHours(this.config.last_hour),m=new Date(d-1),"move"==this._drag_mode&&(n=new Date(+d-o))}if(this._table_view||m.getDate()==n.getDate()&&m.getHours()<this.config.last_hour||scheduler._allow_dnd)if(i.start_date=n,i.end_date=new Date(d),this.config.update_render){var p=scheduler._els.dhx_cal_data[0].scrollTop;this.update_view(),scheduler._els.dhx_cal_data[0].scrollTop=p}else this.updateEvent(this._drag_id);this._table_view&&this.for_rendered(this._drag_id,function(a){a.className+=" dhx_in_move"}),this.callEvent("onEventDrag",[this._drag_id,this._drag_mode,a])}}else if(scheduler.checkEvent("onMouseMove")){var q=this._locate_event(a.target||a.srcElement);this.callEvent("onMouseMove",[q,a])}},scheduler._on_mouse_down=function(a,b){if(2!=a.button&&!this.config.readonly&&!this._drag_mode){b=b||a.target||a.srcElement;var c=b.className&&b.className.split(" ")[0];switch(c){case"dhx_cal_event_line":case"dhx_cal_event_clear":this._table_view&&(this._drag_mode="move");break;case"dhx_event_move":case"dhx_wa_ev_body":this._drag_mode="move";break;case"dhx_event_resize":this._drag_mode="resize",scheduler._drag_from_start=(b.className||"").indexOf("dhx_event_resize_end")<0?!0:!1;break;case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_matrix_cell":case"dhx_marked_timespan":this._drag_mode="create";break;case"":if(b.parentNode)return scheduler._on_mouse_down(a,b.parentNode);break;default:if((!scheduler.checkEvent("onMouseDown")||scheduler.callEvent("onMouseDown",[c]))&&b.parentNode&&b!=this&&"dhx_body"!=c)return scheduler._on_mouse_down(a,b.parentNode);this._drag_mode=null,this._drag_id=null}if(this._drag_mode){var d=this._locate_event(b);this.config["drag_"+this._drag_mode]&&this.callEvent("onBeforeDrag",[d,this._drag_mode,a])?(this._drag_id=d,this._drag_event=scheduler._lame_clone(this.getEvent(this._drag_id)||{})):this._drag_mode=this._drag_id=0}this._drag_start=null}},scheduler._get_private_properties=function(a){var b={};for(var c in a)0===c.indexOf("_")&&(b[c]=!0);return b},scheduler._clear_temporary_properties=function(a,b){var c=this._get_private_properties(a),d=this._get_private_properties(b);for(var e in d)c[e]||delete b[e]},scheduler._on_mouse_up=function(a){if(!a||2!=a.button||!scheduler.config.touch){if(this._drag_mode&&this._drag_id){this._els.dhx_cal_data[0].style.cursor="default";var b=this._drag_id,c=this._drag_mode,d=this.getEvent(this._drag_id);if(this._drag_event._dhx_changed||!this._drag_event.start_date||d.start_date.valueOf()!=this._drag_event.start_date.valueOf()||d.end_date.valueOf()!=this._drag_event.end_date.valueOf()){var e="new-size"==this._drag_mode;if(this.callEvent("onBeforeEventChanged",[d,a,e,this._drag_event]))if(this._drag_id=this._drag_mode=null,e&&this.config.edit_on_create){if(this.unselect(),this._new_event=new Date,this._table_view||this.config.details_on_create||!this.config.select)return scheduler.callEvent("onDragEnd",[b,c,a]),this.showLightbox(b);this._drag_pos=!0,this._select_id=this._edit_id=b}else this._new_event||this.callEvent(e?"onEventAdded":"onEventChanged",[b,this.getEvent(b)]);else e?this.deleteEvent(d.id,!0):(this._drag_event._dhx_changed=!1,this._clear_temporary_properties(d,this._drag_event),scheduler._lame_copy(d,this._drag_event),this.updateEvent(d.id))}this._drag_pos&&this.render_view_data(),scheduler.callEvent("onDragEnd",[b,c,a])}this._drag_id=null,this._drag_mode=null,this._drag_pos=null}},scheduler._trigger_dyn_loading=function(){return this._load_mode&&this._load()?(this._render_wait=!0,!0):!1},scheduler.update_view=function(){var a=this[this._mode+"_view"];return a?a(!0):this._reset_scale(),this._trigger_dyn_loading()?!0:void this.render_view_data()},scheduler.isViewExists=function(a){return!!(scheduler[a+"_view"]||scheduler.date[a+"_start"]&&scheduler.templates[a+"_date"]&&scheduler.templates[a+"_scale_date"])},scheduler.updateView=function(a,b){a=a||this._date,b=b||this._mode;var c="dhx_cal_data";this._mode?this._obj.className=this._obj.className.replace("dhx_scheduler_"+this._mode,"dhx_scheduler_"+b):this._obj.className+=" dhx_scheduler_"+b;var d=this._mode==b&&this.config.preserve_scroll?this._els[c][0].scrollTop:!1;this[this._mode+"_view"]&&b&&this._mode!=b&&this[this._mode+"_view"](!1),this._close_not_saved();var e="dhx_multi_day";this._els[e]&&(this._els[e][0].parentNode.removeChild(this._els[e][0]),this._els[e]=null),this._mode=b,this._date=a,this._table_view="month"==this._mode,this._dy_shift=0;var f=this._els.dhx_cal_tab;if(f)for(var g=0;g<f.length;g++){var h=f[g].className;h=h.replace(/ active/g,""),f[g].getAttribute("name")==this._mode+"_tab"&&(h+=" active"),f[g].className=h}this.update_view(),"number"==typeof d&&(this._els[c][0].scrollTop=d)},scheduler.setCurrentView=function(a,b){this.callEvent("onBeforeViewChange",[this._mode,this._date,b||this._mode,a||this._date])&&(this.updateView(a,b),this.callEvent("onViewChange",[this._mode,this._date]))},scheduler._render_x_header=function(a,b,c,d){var e=document.createElement("DIV");e.className="dhx_scale_bar",this.templates[this._mode+"_scalex_class"]&&(e.className+=" "+this.templates[this._mode+"_scalex_class"](c));var f=this._cols[a]-1;"month"==this._mode&&0===a&&this.config.left_border&&(e.className+=" dhx_scale_bar_border",b+=1),this.set_xy(e,f,this.xy.scale_height-2,b,0),e.innerHTML=this.templates[this._mode+"_scale_date"](c,this._mode),d.appendChild(e)},scheduler._get_columns_num=function(a,b){var c=7;if(!scheduler._table_view){var d=scheduler.date["get_"+scheduler._mode+"_end"];d&&(b=d(a)),c=Math.round((b.valueOf()-a.valueOf())/864e5)}return c},scheduler._get_timeunit_start=function(){return this.date[this._mode+"_start"](new Date(this._date.valueOf()))},scheduler._get_view_end=function(){var a=this._get_timeunit_start(),b=scheduler.date.add(a,1,this._mode);if(!scheduler._table_view){var c=scheduler.date["get_"+scheduler._mode+"_end"];c&&(b=c(a))}return b},scheduler._calc_scale_sizes=function(a,b,c){var d=a,e=this._get_columns_num(b,c);this._process_ignores(b,e,"day",1);for(var f=e-this._ignores_detected,g=0;e>g;g++)this._ignores[g]?(this._cols[g]=0,f++):this._cols[g]=Math.floor(d/(f-g)),d-=this._cols[g],this._colsS[g]=(this._cols[g-1]||0)+(this._colsS[g-1]||(this._table_view?0:this.xy.scale_width+2));this._colsS.col_length=e,this._colsS[e]=this._cols[e-1]+this._colsS[e-1]||0},scheduler._set_scale_col_size=function(a,b,c){var d=this.config;this.set_xy(a,b-1,d.hour_size_px*(d.last_hour-d.first_hour),c+this.xy.scale_width+1,0)},scheduler._render_scales=function(a,b){var c=new Date(scheduler._min_date),d=new Date(scheduler._max_date),e=this.date.date_part(scheduler._currentDate()),f=parseInt(a.style.width,10),g=new Date(this._min_date),h=this._get_columns_num(c,d);this._calc_scale_sizes(f,c,d);var i=0;a.innerHTML="";for(var j=0;h>j;j++){if(this._ignores[j]||this._render_x_header(j,i,g,a),!this._table_view){var k=document.createElement("DIV"),l="dhx_scale_holder";g.valueOf()==e.valueOf()&&(l="dhx_scale_holder_now"),this._ignores_detected&&this._ignores[j]&&(l+=" dhx_scale_ignore"),k.className=l+" "+this.templates.week_date_class(g,e),this._set_scale_col_size(k,this._cols[j],i),b.appendChild(k),this.callEvent("onScaleAdd",[k,g])}i+=this._cols[j],g=this.date.add(g,1,"day")}},scheduler._reset_scale=function(){if(this.templates[this._mode+"_date"]){var a=this._els.dhx_cal_header[0],b=this._els.dhx_cal_data[0],c=this.config;a.innerHTML="",b.innerHTML="";var d=(c.readonly||!c.drag_resize?" dhx_resize_denied":"")+(c.readonly||!c.drag_move?" dhx_move_denied":"");b.className="dhx_cal_data"+d,this._scales={},this._cols=[],this._colsS={height:0},this._dy_shift=0,this.set_sizes();var e,f,g=this._get_timeunit_start(),h=scheduler._get_view_end();if(e=f=this._table_view?scheduler.date.week_start(g):g,this._min_date=e,this._els.dhx_cal_date[0].innerHTML=this.templates[this._mode+"_date"](g,h,this._mode),this._max_date=h,scheduler._render_scales(a,b),this._table_view)this._reset_month_scale(b,g,f);else if(this._reset_hours_scale(b,g,f),c.multi_day){var i="dhx_multi_day";this._els[i]&&(this._els[i][0].parentNode.removeChild(this._els[i][0]),this._els[i]=null);var j=this._els.dhx_cal_navline[0],k=j.offsetHeight+this._els.dhx_cal_header[0].offsetHeight+1,l=document.createElement("DIV");l.className=i,l.style.visibility="hidden",this.set_xy(l,Math.max(this._colsS[this._colsS.col_length]+this.xy.scroll_width-2,0),0,0,k),b.parentNode.insertBefore(l,b);var m=l.cloneNode(!0);m.className=i+"_icon",m.style.visibility="hidden",this.set_xy(m,this.xy.scale_width,0,0,k),l.appendChild(m),this._els[i]=[l,m],this._els[i][0].onclick=this._click.dhx_cal_data}}},scheduler._reset_hours_scale=function(a){var b=document.createElement("DIV");b.className="dhx_scale_holder";for(var c=new Date(1980,1,1,this.config.first_hour,0,0),d=1*this.config.first_hour;d<this.config.last_hour;d++){var e=document.createElement("DIV");e.className="dhx_scale_hour",e.style.height=this.config.hour_size_px-(this._quirks?0:1)+"px";var f=this.xy.scale_width;this.config.left_border&&(f-=1,e.className+=" dhx_scale_hour_border"),e.style.width=f+"px",e.innerHTML=scheduler.templates.hour_scale(c),b.appendChild(e),c=this.date.add(c,1,"hour")}a.appendChild(b),this.config.scroll_hour&&(a.scrollTop=this.config.hour_size_px*(this.config.scroll_hour-this.config.first_hour))},scheduler._currentDate=function(){return scheduler.config.now_date?new Date(scheduler.config.now_date):new Date},scheduler._process_ignores=function(a,b,c,d,e){this._ignores={},this._ignores_detected=0;var f=scheduler["ignore_"+this._mode];if(f)for(var g=new Date(a),h=0;b>h;h++)f(g)&&(this._ignores_detected+=1,this._ignores[h]=!0,e&&b++),g=scheduler.date.add(g,d,c)},scheduler._render_month_scale=function(a,b,c){function d(a){var b=scheduler._colsS.height;return void 0!==scheduler._colsS.heights[a+1]&&(b=scheduler._colsS.heights[a+1]-(scheduler._colsS.heights[a]||0)),b}var e=scheduler.date.add(b,1,"month"),f=new Date(c),g=scheduler._currentDate();this.date.date_part(g),this.date.date_part(c);for(var h=Math.ceil(Math.round((e.valueOf()-c.valueOf())/864e5)/7),i=[],j=0;7>=j;j++){var k=(this._cols[j]||0)-1;0===j&&this.config.left_border&&(k-=1),i[j]=" style='width:"+k+"px;"}for(var l=0,m="<table cellpadding='0' cellspacing='0'>",n=[],j=0;h>j;j++){m+="<tr>";for(var o=Math.max(d(j)-scheduler.xy.month_head_height,0),p=0;7>p;p++){m+="<td";var q="";b>c?q="dhx_before":c>=e?q="dhx_after":c.valueOf()==g.valueOf()&&(q="dhx_now"),this._ignores_detected&&this._ignores[p]&&(q+=" dhx_scale_ignore"),m+=" class='"+q+" "+this.templates.month_date_class(c,g)+"' >";var r="dhx_month_body",s="dhx_month_head";0===p&&this.config.left_border&&(r+=" dhx_month_body_border",s+=" dhx_month_head_border"),this._ignores_detected&&this._ignores[p]?m+="<div></div><div></div>":(m+="<div class='"+s+"'>"+this.templates.month_day(c)+"</div>",m+="<div class='"+r+"' "+i[p]+";height:"+o+"px;'></div></td>"),n.push(c);var t=c.getDate();c=this.date.add(c,1,"day"),c.getDate()-t>1&&(c=new Date(c.getFullYear(),c.getMonth(),t+1,12,0))}m+="</tr>",scheduler._colsS.heights[j]=l,l+=d(j)}m+="</table>",this._min_date=f,this._max_date=c,a.innerHTML=m,this._scales={};for(var u=a.getElementsByTagName("div"),j=0;j<n.length;j++){var a=u[2*j+1],v=n[j];this._scales[+v]=a}for(var j=0;j<n.length;j++){var v=n[j];this.callEvent("onScaleAdd",[this._scales[+v],v])}return this._max_date},scheduler._reset_month_scale=function(a,b,c){var d=scheduler.date.add(b,1,"month"),e=scheduler._currentDate();this.date.date_part(e),this.date.date_part(c);var f=Math.ceil(Math.round((d.valueOf()-c.valueOf())/864e5)/7),g=Math.floor(a.clientHeight/f)-this.xy.month_head_height;return this._colsS.height=g+this.xy.month_head_height,this._colsS.heights=[],scheduler._render_month_scale(a,b,c)},scheduler.getLabel=function(a,b){for(var c=this.config.lightbox.sections,d=0;d<c.length;d++)if(c[d].map_to==a)for(var e=c[d].options,f=0;f<e.length;f++)if(e[f].key==b)return e[f].label;return""},scheduler.updateCollection=function(a,b){var c=scheduler.serverList(a);return c?(c.splice(0,c.length),c.push.apply(c,b||[]),scheduler.callEvent("onOptionsLoad",[]),scheduler.resetLightbox(),!0):!1},scheduler._lame_clone=function(a,b){var c,d,e;for(b=b||[],c=0;c<b.length;c+=2)if(a===b[c])return b[c+1];if(a&&"object"==typeof a){for(e={},d=[Array,Date,Number,String,Boolean],c=0;c<d.length;c++)a instanceof d[c]&&(e=c?new d[c](a):new d[c]);b.push(a,e);for(c in a)Object.prototype.hasOwnProperty.apply(a,[c])&&(e[c]=scheduler._lame_clone(a[c],b))}return e||a},scheduler._lame_copy=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},scheduler._get_date_from_pos=function(a){var b=this._min_date.valueOf()+6e4*(a.y*this.config.time_step+24*(this._table_view?0:a.x)*60);return new Date(this._correct_shift(b))},scheduler.getActionData=function(a){var b=this._mouse_coords(a);return{date:this._get_date_from_pos(b),section:b.section}},scheduler._focus=function(a,b){a&&a.focus&&(this.config.touch?window.setTimeout(function(){a.focus()},100):(b&&a.select&&a.select(),a.focus()))},scheduler._get_real_event_length=function(a,b,c){var d,e=b-a,f=c._start_correction+c._end_correction||0,g=this["ignore_"+this._mode],h=0;for(c.render?(h=this._get_date_index(c,a),d=this._get_date_index(c,b)):d=Math.round(e/60/60/1e3/24);d>h;){var i=scheduler.date.add(b,-c.x_step,c.x_unit);e-=g&&g(b)?b-i:f,b=i,d--}return e},scheduler._get_fictional_event_length=function(a,b,c,d){var e=new Date(a),f=d?-1:1;if(c._start_correction||c._end_correction){var g;g=d?60*e.getHours()+e.getMinutes()-60*(c.first_hour||0):60*(c.last_hour||0)-(60*e.getHours()+e.getMinutes());var h=60*(c.last_hour-c.first_hour),i=Math.ceil((b/6e4-g)/h);b+=i*(1440-h)*60*1e3}var j,k=new Date(1*a+b*f),l=this["ignore_"+this._mode],m=0;for(c.render?(m=this._get_date_index(c,e),j=this._get_date_index(c,k)):j=Math.round(b/60/60/1e3/24);j*f>=m*f;){var n=scheduler.date.add(e,c.x_step*f,c.x_unit);l&&l(e)&&(b+=(n-e)*f,j+=f),e=n,m+=f}return b},scheduler._get_section_view=function(){return this.matrix&&this.matrix[this._mode]?this.matrix[this._mode]:this._props&&this._props[this._mode]?this._props[this._mode]:null},scheduler._get_section_property=function(){return this.matrix&&this.matrix[this._mode]?this.matrix[this._mode].y_property:this._props&&this._props[this._mode]?this._props[this._mode].map_to:null},scheduler._is_initialized=function(){var a=this.getState();return this._obj&&a.date&&a.mode},scheduler._is_lightbox_open=function(){var a=this.getState();return null!==a.lightbox_id&&void 0!==a.lightbox_id},scheduler.date={init:function(){for(var a=scheduler.locale.date.month_short,b=scheduler.locale.date.month_short_hash={},c=0;c<a.length;c++)b[a[c]]=c;for(var a=scheduler.locale.date.month_full,b=scheduler.locale.date.month_full_hash={},c=0;c<a.length;c++)b[a[c]]=c},date_part:function(a){return a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),0!==a.getHours()&&a.setTime(a.getTime()+36e5*(24-a.getHours())),a},time_part:function(a){return(a.valueOf()/1e3-60*a.getTimezoneOffset())%86400},week_start:function(a){var b=a.getDay();return scheduler.config.start_on_monday&&(0===b?b=6:b--),this.date_part(this.add(a,-1*b,"day"))},month_start:function(a){return a.setDate(1),this.date_part(a)},year_start:function(a){return a.setMonth(0),this.month_start(a)},day_start:function(a){return this.date_part(a)},_add_days:function(a,b){var c=new Date(a.valueOf());return c.setDate(c.getDate()+b),!a.getHours()&&c.getHours()&&c.setTime(c.getTime()+36e5*(24-c.getHours())),c},add:function(a,b,c){var d=new Date(a.valueOf());switch(c){case"day":d=scheduler.date._add_days(d,b);break;case"week":d=scheduler.date._add_days(d,7*b);break;case"month":d.setMonth(d.getMonth()+b);break;case"year":d.setYear(d.getFullYear()+b);break;case"hour":d.setTime(d.getTime()+60*b*60*1e3);break;case"minute":d.setTime(d.getTime()+60*b*1e3);break;default:return scheduler.date["add_"+c](a,b,c)}return d},to_fixed:function(a){return 10>a?"0"+a:a},copy:function(a){return new Date(a.valueOf())},date_to_str:function(a,b){return a=a.replace(/%[a-zA-Z]/g,function(a){switch(a){case"%d":return'"+scheduler.date.to_fixed(date.getDate())+"';case"%m":return'"+scheduler.date.to_fixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+scheduler.date.to_fixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+scheduler.locale.date.day_short[date.getDay()]+"';case"%l":return'"+scheduler.locale.date.day_full[date.getDay()]+"';case"%M":return'"+scheduler.locale.date.month_short[date.getMonth()]+"';case"%F":return'"+scheduler.locale.date.month_full[date.getMonth()]+"';case"%h":return'"+scheduler.date.to_fixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+scheduler.date.to_fixed(date.getHours())+"';case"%i":return'"+scheduler.date.to_fixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';case"%s":return'"+scheduler.date.to_fixed(date.getSeconds())+"';case"%W":return'"+scheduler.date.to_fixed(scheduler.date.getISOWeek(date))+"';default:return a}}),b&&(a=a.replace(/date\.get/g,"date.getUTC")),new Function("date",'return "'+a+'";')},str_to_date:function(a,b){for(var c="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",d=a.match(/%[a-zA-Z]/g),e=0;e<d.length;e++)switch(d[e]){case"%j":case"%d":c+="set[2]=temp["+e+"]||1;";break;case"%n":case"%m":c+="set[1]=(temp["+e+"]||1)-1;";break;case"%y":c+="set[0]=temp["+e+"]*1+(temp["+e+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":c+="set[3]=temp["+e+"]||0;";break;case"%i":c+="set[4]=temp["+e+"]||0;";break;case"%Y":c+="set[0]=temp["+e+"]||0;";break;case"%a":case"%A":c+="set[3]=set[3]%12+((temp["+e+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":c+="set[5]=temp["+e+"]||0;";break;case"%M":c+="set[1]=scheduler.locale.date.month_short_hash[temp["+e+"]]||0;";break;case"%F":c+="set[1]=scheduler.locale.date.month_full_hash[temp["+e+"]]||0;"}var f="set[0],set[1],set[2],set[3],set[4],set[5]";return b&&(f=" Date.UTC("+f+")"),new Function("date","var set=[0,0,1,0,0,0]; "+c+" return new Date("+f+");")},getISOWeek:function(a){if(!a)return!1;var b=a.getDay();0===b&&(b=7);var c=new Date(a.valueOf());c.setDate(a.getDate()+(4-b));var d=c.getFullYear(),e=Math.round((c.getTime()-new Date(d,0,1).getTime())/864e5),f=1+Math.floor(e/7);return f},getUTCISOWeek:function(a){return this.getISOWeek(this.convert_to_utc(a))},convert_to_utc:function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())}},scheduler.locale={date:{month_full:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},labels:{dhx_cal_today_button:"Today",day_tab:"Day",week_tab:"Week",month_tab:"Month",new_event:"New event",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Event will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",full_day:"Full day",confirm_recurring:"Do you want to edit the whole set of repeated events?",section_recurring:"Repeat event",button_recurring:"Disabled",button_recurring_open:"Enabled",button_edit_series:"Edit series",button_edit_occurrence:"Edit occurrence",agenda_tab:"Agenda",date:"Date",description:"Description",year_tab:"Year",week_agenda_tab:"Agenda",grid_tab:"Grid",drag_to_create:"Drag to create",drag_to_move:"Drag to move",message_ok:"OK",message_cancel:"Cancel"}},scheduler.config={default_date:"%j %M %Y",month_date:"%F %Y",load_date:"%Y-%m-%d",week_date:"%l",day_date:"%D, %F %j",hour_date:"%H:%i",month_day:"%d",xml_date:"%m/%d/%Y %H:%i",api_date:"%d-%m-%Y %H:%i",preserve_length:!0,time_step:5,start_on_monday:1,first_hour:0,last_hour:24,readonly:!1,drag_resize:1,drag_move:1,drag_create:1,dblclick_create:1,edit_on_create:1,details_on_create:0,resize_month_events:!1,resize_month_timed:!1,cascade_event_display:!1,cascade_event_count:4,cascade_event_margin:30,multi_day:!0,multi_day_height_limit:0,drag_lightbox:!0,preserve_scroll:!0,select:!0,server_utc:!1,touch:!0,touch_tip:!0,touch_drag:500,quick_info_detached:!0,positive_closing:!1,drag_highlight:!0,limit_drag_out:!1,icons_edit:["icon_save","icon_cancel"],icons_select:["icon_details","icon_edit","icon_delete"],buttons_left:["dhx_save_btn","dhx_cancel_btn"],buttons_right:["dhx_delete_btn"],lightbox:{sections:[{name:"description",height:200,map_to:"text",type:"textarea",focus:!0},{name:"time",height:72,type:"time",map_to:"auto"}]},highlight_displayed_event:!0,left_border:!1,ajax_error:"alert",delay_render:0},scheduler.templates={},scheduler.init_templates=function(){var a=scheduler.locale.labels;a.dhx_save_btn=a.icon_save,a.dhx_cancel_btn=a.icon_cancel,a.dhx_delete_btn=a.icon_delete;var b=scheduler.date.date_to_str,c=scheduler.config,d=function(a,b){for(var c in b)a[c]||(a[c]=b[c])};d(scheduler.templates,{day_date:b(c.default_date),month_date:b(c.month_date),week_date:function(a,b){return scheduler.templates.day_date(a)+" &ndash; "+scheduler.templates.day_date(scheduler.date.add(b,-1,"day"))
},day_scale_date:b(c.default_date),month_scale_date:b(c.week_date),week_scale_date:b(c.day_date),hour_scale:b(c.hour_date),time_picker:b(c.hour_date),event_date:b(c.hour_date),month_day:b(c.month_day),xml_date:scheduler.date.str_to_date(c.xml_date,c.server_utc),load_format:b(c.load_date,c.server_utc),xml_format:b(c.xml_date,c.server_utc),api_date:scheduler.date.str_to_date(c.api_date),event_header:function(a,b){return scheduler.templates.event_date(a)+" - "+scheduler.templates.event_date(b)},event_text:function(a,b,c){return c.text},event_class:function(){return""},month_date_class:function(){return""},week_date_class:function(){return""},event_bar_date:function(a){return scheduler.templates.event_date(a)+" "},event_bar_text:function(a,b,c){return c.text},month_events_link:function(a,b){return"<a>View more("+b+" events)</a>"},drag_marker_class:function(){return""},drag_marker_content:function(){return""}}),this.callEvent("onTemplatesReady",[])},scheduler.uid=function(){return this._seed||(this._seed=(new Date).valueOf()),this._seed++},scheduler._events={},scheduler.clearAll=function(){this._events={},this._loaded={},this._edit_id=null,this._select_id=null,this._drag_id=null,this._drag_mode=null,this._drag_pos=null,this.clear_view(),this.callEvent("onClearAll",[])},scheduler.addEvent=function(a,b,c,d,e){if(!arguments.length)return this.addEventNow();var f=a;1!=arguments.length&&(f=e||{},f.start_date=a,f.end_date=b,f.text=c,f.id=d),f.id=f.id||scheduler.uid(),f.text=f.text||"","string"==typeof f.start_date&&(f.start_date=this.templates.api_date(f.start_date)),"string"==typeof f.end_date&&(f.end_date=this.templates.api_date(f.end_date));var g=6e4*(this.config.event_duration||this.config.time_step);f.start_date.valueOf()==f.end_date.valueOf()&&f.end_date.setTime(f.end_date.valueOf()+g),f._timed=this.isOneDayEvent(f);var h=!this._events[f.id];return this._events[f.id]=f,this.event_updated(f),this._loading||this.callEvent(h?"onEventAdded":"onEventChanged",[f.id,f]),f.id},scheduler.deleteEvent=function(a,b){var c=this._events[a];(b||this.callEvent("onBeforeEventDelete",[a,c])&&this.callEvent("onConfirmedBeforeEventDelete",[a,c]))&&(c&&(this._select_id=null,delete this._events[a],this.event_updated(c)),this.callEvent("onEventDeleted",[a,c]))},scheduler.getEvent=function(a){return this._events[a]},scheduler.setEvent=function(a,b){b.id||(b.id=a),this._events[a]=b},scheduler.for_rendered=function(a,b){for(var c=this._rendered.length-1;c>=0;c--)this._rendered[c].getAttribute("event_id")==a&&b(this._rendered[c],c)},scheduler.changeEventId=function(a,b){if(a!=b){var c=this._events[a];c&&(c.id=b,this._events[b]=c,delete this._events[a]),this.for_rendered(a,function(a){a.setAttribute("event_id",b)}),this._select_id==a&&(this._select_id=b),this._edit_id==a&&(this._edit_id=b),this.callEvent("onEventIdChange",[a,b])}},function(){for(var a=["text","Text","start_date","StartDate","end_date","EndDate"],b=function(a){return function(b){return scheduler.getEvent(b)[a]}},c=function(a){return function(b,c){var d=scheduler.getEvent(b);d[a]=c,d._changed=!0,d._timed=this.isOneDayEvent(d),scheduler.event_updated(d,!0)}},d=0;d<a.length;d+=2)scheduler["getEvent"+a[d+1]]=b(a[d]),scheduler["setEvent"+a[d+1]]=c(a[d])}(),scheduler.event_updated=function(a){this.is_visible_events(a)?this.render_view_data():this.clear_event(a.id)},scheduler.is_visible_events=function(a){var b=a.start_date<this._max_date&&this._min_date<a.end_date;if(b){var c=a.end_date.getHours()>=this.config.first_hour&&a.end_date.getHours()<this.config.last_hour||a.start_date.getHours()>=this.config.first_hour&&a.start_date.getHours()<this.config.last_hour;if(c)return!0;var d=(a.end_date.valueOf()-a.start_date.valueOf())/36e5,e=24-(this.config.last_hour-this.config.first_hour);return d>e}return!1},scheduler.isOneDayEvent=function(a){var b=a.end_date.getDate()-a.start_date.getDate();return b?(0>b&&(b=Math.ceil((a.end_date.valueOf()-a.start_date.valueOf())/864e5)),1==b&&!a.end_date.getHours()&&!a.end_date.getMinutes()&&(a.start_date.getHours()||a.start_date.getMinutes())):a.start_date.getMonth()==a.end_date.getMonth()&&a.start_date.getFullYear()==a.end_date.getFullYear()},scheduler.get_visible_events=function(a){var b=[];for(var c in this._events)this.is_visible_events(this._events[c])&&(!a||this._events[c]._timed)&&this.filter_event(c,this._events[c])&&b.push(this._events[c]);return b},scheduler.filter_event=function(a,b){var c=this["filter_"+this._mode];return c?c(a,b):!0},scheduler._is_main_area_event=function(a){return!!a._timed},scheduler.render_view_data=function(a,b){if(!a){if(this._not_render)return void(this._render_wait=!0);this._render_wait=!1,this.clear_view(),a=this.get_visible_events(!(this._table_view||this.config.multi_day))}for(var c=0,d=a.length;d>c;c++)this._recalculate_timed(a[c]);if(this.config.multi_day&&!this._table_view){for(var e=[],f=[],c=0;c<a.length;c++)this._is_main_area_event(a[c])?e.push(a[c]):f.push(a[c]);this._rendered_location=this._els.dhx_multi_day[0],this._table_view=!0,this.render_data(f,b),this._table_view=!1,this._rendered_location=this._els.dhx_cal_data[0],this._table_view=!1,this.render_data(e,b)}else this._rendered_location=this._els.dhx_cal_data[0],this.render_data(a,b)},scheduler._view_month_day=function(a){var b=scheduler.getActionData(a).date;scheduler.callEvent("onViewMoreClick",[b])&&scheduler.setCurrentView(b,"day")},scheduler._render_month_link=function(a){for(var b=this._rendered_location,c=this._lame_clone(a),d=a._sday;d<a._eday;d++){c._sday=d,c._eday=d+1;var e=scheduler.date,f=scheduler._min_date;f=e.add(f,c._sweek,"week"),f=e.add(f,c._sday,"day");var g=scheduler.getEvents(f,e.add(f,1,"day")).length,h=this._get_event_bar_pos(c),i=h.x2-h.x,j=document.createElement("div");j.onclick=function(a){scheduler._view_month_day(a||event)},j.className="dhx_month_link",j.style.top=h.y+"px",j.style.left=h.x+"px",j.style.width=i+"px",j.innerHTML=scheduler.templates.month_events_link(f,g),this._rendered.push(j),b.appendChild(j)}},scheduler._recalculate_timed=function(a){if(a){var b;b="object"!=typeof a?this._events[a]:a,b&&(b._timed=scheduler.isOneDayEvent(b))}},scheduler.attachEvent("onEventChanged",scheduler._recalculate_timed),scheduler.attachEvent("onEventAdded",scheduler._recalculate_timed),scheduler.render_data=function(a,b){a=this._pre_render_events(a,b);for(var c=0;c<a.length;c++)if(this._table_view)if("month"!=scheduler._mode)this.render_event_bar(a[c]);else{var d=scheduler.config.max_month_events;d!==1*d||a[c]._sorder<d?this.render_event_bar(a[c]):void 0!==d&&a[c]._sorder==d&&scheduler._render_month_link(a[c])}else this.render_event(a[c])},scheduler._pre_render_events=function(a,b){var c=this.xy.bar_height,d=this._colsS.heights,e=this._colsS.heights=[0,0,0,0,0,0,0],f=this._els.dhx_cal_data[0];if(a=this._table_view?this._pre_render_events_table(a,b):this._pre_render_events_line(a,b),this._table_view)if(b)this._colsS.heights=d;else{var g=f.firstChild;if(g.rows){for(var h=0;h<g.rows.length;h++){e[h]++;var i=this._colsS.height-this.xy.month_head_height;if(e[h]*c>i){var j=g.rows[h].cells,k=i;1*this.config.max_month_events!==this.config.max_month_events||e[h]<=this.config.max_month_events?k=e[h]*c:(this.config.max_month_events+1)*c>i&&(k=(this.config.max_month_events+1)*c);for(var l=0;l<j.length;l++)j[l].childNodes[1].style.height=k+"px";e[h]=(e[h-1]||0)+j[0].offsetHeight}e[h]=(e[h-1]||0)+g.rows[h].cells[0].offsetHeight}if(e.unshift(0),g.parentNode.offsetHeight<g.parentNode.scrollHeight&&!scheduler._colsS.scroll_fix&&scheduler.xy.scroll_width){var m=scheduler._colsS,n=m[m.col_length],o=m.heights.slice();n-=scheduler.xy.scroll_width||0,this._calc_scale_sizes(n,this._min_date,this._max_date),scheduler._colsS.heights=o,this.set_xy(this._els.dhx_cal_header[0],n,this.xy.scale_height),scheduler._render_scales(this._els.dhx_cal_header[0]),scheduler._render_month_scale(this._els.dhx_cal_data[0],this._get_timeunit_start(),this._min_date),m.scroll_fix=!0}}else if(a.length||"visible"!=this._els.dhx_multi_day[0].style.visibility||(e[0]=-1),a.length||-1==e[0]){var p=(g.parentNode.childNodes,(e[0]+1)*c+1),q=p,r=p+"px";this.config.multi_day_height_limit&&(q=Math.min(p,this.config.multi_day_height_limit),r=q+"px"),f.style.top=this._els.dhx_cal_navline[0].offsetHeight+this._els.dhx_cal_header[0].offsetHeight+q+"px",f.style.height=this._obj.offsetHeight-parseInt(f.style.top,10)-(this.xy.margin_top||0)+"px";var s=this._els.dhx_multi_day[0];s.style.height=r,s.style.visibility=-1==e[0]?"hidden":"visible";var t=this._els.dhx_multi_day[1];t.style.height=r,t.style.visibility=-1==e[0]?"hidden":"visible",t.className=e[0]?"dhx_multi_day_icon":"dhx_multi_day_icon_small",this._dy_shift=(e[0]+1)*c,this.config.multi_day_height_limit&&(this._dy_shift=Math.min(this.config.multi_day_height_limit,this._dy_shift)),e[0]=0,q!=p&&(f.style.top=parseInt(f.style.top)+2+"px",s.style.overflowY="auto",t.style.position="fixed",t.style.top="",t.style.left="")}}return a},scheduler._get_event_sday=function(a){return Math.floor((a.start_date.valueOf()-this._min_date.valueOf())/864e5)},scheduler._get_event_mapped_end_date=function(a){var b=a.end_date;if(this.config.separate_short_events){var c=(a.end_date-a.start_date)/6e4;c<this._min_mapped_duration&&(b=this.date.add(b,this._min_mapped_duration-c,"minute"))}return b},scheduler._pre_render_events_line=function(a,b){a.sort(function(a,b){return a.start_date.valueOf()==b.start_date.valueOf()?a.id>b.id?1:-1:a.start_date>b.start_date?1:-1});var c=[],d=[];this._min_mapped_duration=Math.ceil(60*this.xy.min_event_height/this.config.hour_size_px);for(var e=0;e<a.length;e++){var f=a[e],g=f.start_date,h=f.end_date,i=g.getHours(),j=h.getHours();if(f._sday=this._get_event_sday(f),this._ignores[f._sday])a.splice(e,1),e--;else{if(c[f._sday]||(c[f._sday]=[]),!b){f._inner=!1;for(var k=c[f._sday];k.length;){var l=k[k.length-1],m=this._get_event_mapped_end_date(l);if(!(m.valueOf()<=f.start_date.valueOf()))break;k.splice(k.length-1,1)}for(var n=k.length,o=!1,p=0;p<k.length;p++){var l=k[p],m=this._get_event_mapped_end_date(l);if(m.valueOf()<=f.start_date.valueOf()){o=!0,f._sorder=l._sorder,n=p,f._inner=!0;break}}if(k.length&&(k[k.length-1]._inner=!0),!o)if(k.length)if(k.length<=k[k.length-1]._sorder){if(k[k.length-1]._sorder)for(p=0;p<k.length;p++){for(var q=!1,r=0;r<k.length;r++)if(k[r]._sorder==p){q=!0;break}if(!q){f._sorder=p;break}}else f._sorder=0;f._inner=!0}else{var s=k[0]._sorder;for(p=1;p<k.length;p++)k[p]._sorder>s&&(s=k[p]._sorder);f._sorder=s+1,f._inner=!1}else f._sorder=0;k.splice(n,n==k.length?0:1,f),k.length>(k.max_count||0)?(k.max_count=k.length,f._count=k.length):f._count=f._count?f._count:1}(i<this.config.first_hour||j>=this.config.last_hour)&&(d.push(f),a[e]=f=this._copy_event(f),i<this.config.first_hour&&(f.start_date.setHours(this.config.first_hour),f.start_date.setMinutes(0)),j>=this.config.last_hour&&(f.end_date.setMinutes(0),f.end_date.setHours(this.config.last_hour)),f.start_date>f.end_date||i==this.config.last_hour)&&(a.splice(e,1),e--)}}if(!b){for(var e=0;e<a.length;e++)a[e]._count=c[a[e]._sday].max_count;for(var e=0;e<d.length;e++)d[e]._count=c[d[e]._sday].max_count}return a},scheduler._time_order=function(a){a.sort(function(a,b){return a.start_date.valueOf()==b.start_date.valueOf()?a._timed&&!b._timed?1:!a._timed&&b._timed?-1:a.id>b.id?1:-1:a.start_date>b.start_date?1:-1})},scheduler._pre_render_events_table=function(a,b){this._time_order(a);for(var c,d=[],e=[[],[],[],[],[],[],[]],f=this._colsS.heights,g=this._cols.length,h={},i=0;i<a.length;i++){var j=a[i],k=j.id;h[k]||(h[k]={first_chunk:!0,last_chunk:!0});var l=h[k],m=c||j.start_date,n=j.end_date;m<this._min_date&&(l.first_chunk=!1,m=this._min_date),n>this._max_date&&(l.last_chunk=!1,n=this._max_date);var o=this.locate_holder_day(m,!1,j);if(j._sday=o%g,!this._ignores[j._sday]||!j._timed){var p=this.locate_holder_day(n,!0,j)||g;j._eday=p%g||g,j._length=p-o,j._sweek=Math.floor((this._correct_shift(m.valueOf(),1)-this._min_date.valueOf())/(864e5*g));var q,r=e[j._sweek];for(q=0;q<r.length&&!(r[q]._eday<=j._sday);q++);if(j._sorder&&b||(j._sorder=q),j._sday+j._length<=g)c=null,d.push(j),r[q]=j,f[j._sweek]=r.length-1,j._first_chunk=l.first_chunk,j._last_chunk=l.last_chunk;else{var s=this._copy_event(j);s.id=j.id,s._length=g-j._sday,s._eday=g,s._sday=j._sday,s._sweek=j._sweek,s._sorder=j._sorder,s.end_date=this.date.add(m,s._length,"day"),s._first_chunk=l.first_chunk,l.first_chunk&&(l.first_chunk=!1),d.push(s),r[q]=s,c=s.end_date,f[j._sweek]=r.length-1,i--}}}return d},scheduler._copy_dummy=function(){var a=new Date(this.start_date),b=new Date(this.end_date);this.start_date=a,this.end_date=b},scheduler._copy_event=function(a){return this._copy_dummy.prototype=a,new this._copy_dummy},scheduler._rendered=[],scheduler.clear_view=function(){for(var a=0;a<this._rendered.length;a++){var b=this._rendered[a];b.parentNode&&b.parentNode.removeChild(b)}this._rendered=[]},scheduler.updateEvent=function(a){var b=this.getEvent(a);this.clear_event(a),b&&this.is_visible_events(b)&&this.filter_event(a,b)&&(this._table_view||this.config.multi_day||b._timed)&&(this.config.update_render?this.render_view_data():"month"!=this.getState().mode||this.getState().drag_id||this.isOneDayEvent(b)?this.render_view_data([b],!0):this.render_view_data())},scheduler.clear_event=function(a){this.for_rendered(a,function(a,b){a.parentNode&&a.parentNode.removeChild(a),scheduler._rendered.splice(b,1)})},scheduler._y_from_date=function(a){var b=60*a.getHours()+a.getMinutes();return Math.round((60*b*1e3-60*this.config.first_hour*60*1e3)*this.config.hour_size_px/36e5)%(24*this.config.hour_size_px)},scheduler._calc_event_y=function(a,b){b=b||0;var c=60*a.start_date.getHours()+a.start_date.getMinutes(),d=60*a.end_date.getHours()+a.end_date.getMinutes()||60*scheduler.config.last_hour,e=this._y_from_date(a.start_date),f=Math.max(b,(d-c)*this.config.hour_size_px/60);return{top:e,height:f}},scheduler.render_event=function(a){var b=scheduler.xy.menu_width,c=this.config.use_select_menu_space?0:b;if(!(a._sday<0)){var d=scheduler.locate_holder(a._sday);if(d){var e=this._calc_event_y(a,scheduler.xy.min_event_height),f=e.top,g=e.height,h=a._count||1,i=a._sorder||0,j=Math.floor((d.clientWidth-c)/h),k=i*j+1;if(a._inner||(j*=h-i),this.config.cascade_event_display){var l=this.config.cascade_event_count,m=this.config.cascade_event_margin;k=i%l*m;var n=a._inner?(h-i-1)%l*m/2:0;j=Math.floor(d.clientWidth-c-k-n)}var o=this._render_v_bar(a,c+k,f,j,g,a._text_style,scheduler.templates.event_header(a.start_date,a.end_date,a),scheduler.templates.event_text(a.start_date,a.end_date,a));if(this._rendered.push(o),d.appendChild(o),k=k+parseInt(d.style.left,10)+c,this._edit_id==a.id){o.style.zIndex=1,j=Math.max(j-4,scheduler.xy.editor_width),o=document.createElement("DIV"),o.setAttribute("event_id",a.id),this.set_xy(o,j,g-20,k,f+14),o.className="dhx_cal_event dhx_cal_editor";var p=scheduler.templates.event_class(a.start_date,a.end_date,a);p&&(o.className+=" "+p);var q=document.createElement("DIV");this.set_xy(q,j-6,g-26),q.style.cssText+=";margin:2px 2px 2px 2px;overflow:hidden;",o.appendChild(q),this._els.dhx_cal_data[0].appendChild(o),this._rendered.push(o),q.innerHTML="<textarea class='dhx_cal_editor'>"+a.text+"</textarea>",this._quirks7&&(q.firstChild.style.height=g-12+"px"),this._editor=q.firstChild,this._editor.onkeydown=function(a){if((a||event).shiftKey)return!0;var b=(a||event).keyCode;b==scheduler.keys.edit_save&&scheduler.editStop(!0),b==scheduler.keys.edit_cancel&&scheduler.editStop(!1)},this._editor.onselectstart=function(a){return(a||event).cancelBubble=!0,!0},scheduler._focus(q.firstChild,!0),this._els.dhx_cal_data[0].scrollLeft=0}if(0!==this.xy.menu_width&&this._select_id==a.id){this.config.cascade_event_display&&this._drag_mode&&(o.style.zIndex=1);for(var r=this.config["icons_"+(this._edit_id==a.id?"edit":"select")],s="",t=a.color?"background-color: "+a.color+";":"",u=a.textColor?"color: "+a.textColor+";":"",v=0;v<r.length;v++)s+="<div class='dhx_menu_icon "+r[v]+"' style='"+t+u+"' title='"+this.locale.labels[r[v]]+"'></div>";var w=this._render_v_bar(a,k-b+1,f,b,20*r.length+26-2,"","<div style='"+t+u+"' class='dhx_menu_head'></div>",s,!0);w.style.left=k-b+1,this._els.dhx_cal_data[0].appendChild(w),this._rendered.push(w)}this.config.drag_highlight&&this._drag_id==a.id&&this.highlightEventPosition(a)}}},scheduler._render_v_bar=function(a,b,c,d,e,f,g,h,i){var j=document.createElement("DIV"),k=a.id,l=i?"dhx_cal_event dhx_cal_select_menu":"dhx_cal_event",m=scheduler.templates.event_class(a.start_date,a.end_date,a);m&&(l=l+" "+m);var n=a.color?"background:"+a.color+";":"",o=a.textColor?"color:"+a.textColor+";":"",p='<div event_id="'+k+'" class="'+l+'" style="position:absolute; top:'+c+"px; left:"+b+"px; width:"+(d-4)+"px; height:"+e+"px;"+(f||"")+'"></div>';j.innerHTML=p;var q=j.cloneNode(!0).firstChild;if(!i&&scheduler.renderEvent(q,a,d,e,g,h))return q;q=j.firstChild;var r='<div class="dhx_event_move dhx_header" style=" width:'+(d-6)+"px;"+n+'" >&nbsp;</div>';r+='<div class="dhx_event_move dhx_title" style="'+n+o+'">'+g+"</div>",r+='<div class="dhx_body" style=" width:'+(d-(this._quirks?4:14))+"px; height:"+(e-(this._quirks?20:30)+1)+"px;"+n+o+'">'+h+"</div>";var s="dhx_event_resize dhx_footer";return i&&(s="dhx_resize_denied "+s),r+='<div class="'+s+'" style=" width:'+(d-8)+"px;"+(i?" margin-top:-1px;":"")+n+o+'" ></div>',q.innerHTML=r,q},scheduler.renderEvent=function(){return!1},scheduler.locate_holder=function(a){return"day"==this._mode?this._els.dhx_cal_data[0].firstChild:this._els.dhx_cal_data[0].childNodes[a]},scheduler.locate_holder_day=function(a,b){var c=Math.floor((this._correct_shift(a,1)-this._min_date)/864e5);return b&&this.date.time_part(a)&&c++,c},scheduler._get_dnd_order=function(a,b,c){if(!this._drag_event)return a;this._drag_event._orig_sorder?a=this._drag_event._orig_sorder:this._drag_event._orig_sorder=a;for(var d=b*a;d+b>c;)a--,d-=b;return a=Math.max(a,0)},scheduler._get_event_bar_pos=function(a){var b=this._colsS[a._sday],c=this._colsS[a._eday];c==b&&(c=this._colsS[a._eday+1]);var d=this.xy.bar_height,e=a._sorder;if(a.id==this._drag_id){var f=this._colsS.heights[a._sweek+1]-this._colsS.heights[a._sweek]-this.xy.month_head_height;e=scheduler._get_dnd_order(e,d,f)}var g=e*d,h=this._colsS.heights[a._sweek]+(this._colsS.height?this.xy.month_scale_height+2:2)+g;return{x:b,x2:c,y:h}},scheduler.render_event_bar=function(a){var b=this._rendered_location,c=this._get_event_bar_pos(a),d=c.y,e=c.x,f=c.x2,g="";if(f){var h=scheduler.config.resize_month_events&&"month"==this._mode&&(!a._timed||scheduler.config.resize_month_timed),i=document.createElement("DIV"),j=a.hasOwnProperty("_first_chunk")&&a._first_chunk,k=a.hasOwnProperty("_last_chunk")&&a._last_chunk,l=h&&(a._timed||j),m=h&&(a._timed||k),n="dhx_cal_event_clear";(!a._timed||h)&&(n="dhx_cal_event_line"),j&&(n+=" dhx_cal_event_line_start"),k&&(n+=" dhx_cal_event_line_end"),l&&(g+="<div class='dhx_event_resize dhx_event_resize_start'></div>"),m&&(g+="<div class='dhx_event_resize dhx_event_resize_end'></div>");var o=scheduler.templates.event_class(a.start_date,a.end_date,a);o&&(n+=" "+o);var p=a.color?"background:"+a.color+";":"",q=a.textColor?"color:"+a.textColor+";":"",r=["position:absolute","top:"+d+"px","left:"+e+"px","width:"+(f-e-15)+"px",q,p,a._text_style||""].join(";"),s='<div event_id="'+a.id+'" class="'+n+'" style="'+r+'">';h&&(s+=g),"month"==scheduler.getState().mode&&(a=scheduler.getEvent(a.id)),a._timed&&(s+=scheduler.templates.event_bar_date(a.start_date,a.end_date,a)),s+=scheduler.templates.event_bar_text(a.start_date,a.end_date,a)+"</div>",s+="</div>",i.innerHTML=s,this._rendered.push(i.firstChild),b.appendChild(i.firstChild)}},scheduler._locate_event=function(a){for(var b=null;a&&!b&&a.getAttribute;)b=a.getAttribute("event_id"),a=a.parentNode;return b},scheduler.edit=function(a){this._edit_id!=a&&(this.editStop(!1,a),this._edit_id=a,this.updateEvent(a))},scheduler.editStop=function(a,b){if(!b||this._edit_id!=b){var c=this.getEvent(this._edit_id);c&&(a&&(c.text=this._editor.value),this._edit_id=null,this._editor=null,this.updateEvent(c.id),this._edit_stop_event(c,a))}},scheduler._edit_stop_event=function(a,b){this._new_event?(b?this.callEvent("onEventAdded",[a.id,a]):a&&this.deleteEvent(a.id,!0),this._new_event=null):b&&this.callEvent("onEventChanged",[a.id,a])},scheduler.getEvents=function(a,b){var c=[];for(var d in this._events){var e=this._events[d];e&&(!a&&!b||e.start_date<b&&e.end_date>a)&&c.push(e)}return c},scheduler.getRenderedEvent=function(a){if(a){for(var b=scheduler._rendered,c=0;c<b.length;c++){var d=b[c];if(d.getAttribute("event_id")==a)return d}return null}},scheduler.showEvent=function(a,b){var c="number"==typeof a||"string"==typeof a?scheduler.getEvent(a):a;if(b=b||scheduler._mode,c&&(!this.checkEvent("onBeforeEventDisplay")||this.callEvent("onBeforeEventDisplay",[c,b]))){var d=scheduler.config.scroll_hour;scheduler.config.scroll_hour=c.start_date.getHours();var e=scheduler.config.preserve_scroll;scheduler.config.preserve_scroll=!1;var f=c.color,g=c.textColor;scheduler.config.highlight_displayed_event&&(c.color=scheduler.config.displayed_event_color,c.textColor=scheduler.config.displayed_event_text_color),scheduler.setCurrentView(new Date(c.start_date),b),c.color=f,c.textColor=g,scheduler.config.scroll_hour=d,scheduler.config.preserve_scroll=e,scheduler.matrix&&scheduler.matrix[b]&&(scheduler._els.dhx_cal_data[0].scrollTop=getAbsoluteTop(scheduler.getRenderedEvent(c.id))-getAbsoluteTop(scheduler._els.dhx_cal_data[0])-20),scheduler.callEvent("onAfterEventDisplay",[c,b])}},scheduler._append_drag_marker=function(a){if(!a.parentNode){var b=scheduler._els.dhx_cal_data[0],c=b.lastChild;c.className&&c.className.indexOf("dhx_scale_holder")<0&&c.previousSibling&&(c=c.previousSibling),c&&0===c.className.indexOf("dhx_scale_holder")&&c.appendChild(a)}},scheduler._update_marker_position=function(a,b){var c=scheduler._calc_event_y(b,0);a.style.top=c.top+"px",a.style.height=c.height+"px"},scheduler.highlightEventPosition=function(a){var b=document.createElement("div");b.setAttribute("event_id",a.id),this._rendered.push(b),this._update_marker_position(b,a);var c=this.templates.drag_marker_class(a.start_date,a.end_date,a),d=this.templates.drag_marker_content(a.start_date,a.end_date,a);b.className="dhx_drag_marker",c&&(b.className+=" "+c),d&&(b.innerHTML=d),this._append_drag_marker(b)},scheduler._loaded={},scheduler._load=function(a,b){if(a=a||this._load_url){a+=(-1==a.indexOf("?")?"?":"&")+"timeshift="+(new Date).getTimezoneOffset(),this.config.prevent_cache&&(a+="&uid="+this.uid());var c;if(b=b||this._date,this._load_mode){var d=this.templates.load_format;for(b=this.date[this._load_mode+"_start"](new Date(b.valueOf()));b>this._min_date;)b=this.date.add(b,-1,this._load_mode);c=b;for(var e=!0;c<this._max_date;)c=this.date.add(c,1,this._load_mode),this._loaded[d(b)]&&e?b=this.date.add(b,1,this._load_mode):e=!1;var f=c;do c=f,f=this.date.add(c,-1,this._load_mode);while(f>b&&this._loaded[d(f)]);if(b>=c)return!1;for(dhtmlxAjax.get(a+"&from="+d(b)+"&to="+d(c),function(a){scheduler.on_load(a)});c>b;)this._loaded[d(b)]=!0,b=this.date.add(b,1,this._load_mode)}else dhtmlxAjax.get(a,function(a){scheduler.on_load(a)});return this.callEvent("onXLS",[]),!0}},scheduler.on_load=function(a){var b,c=!1;if(this._process&&"xml"!=this._process)try{b=this[this._process].parse(a.xmlDoc.responseText)}catch(d){c=!0}else b=this._magic_parser(a),b||(c=!0);c&&(this.callEvent("onLoadError",[a.xmlDoc]),b=[]),scheduler._process_loading(b),this.callEvent("onXLE",[])},scheduler._process_loading=function(a){this._loading=!0,this._not_render=!0;for(var b=0;b<a.length;b++)this.callEvent("onEventLoading",[a[b]])&&this.addEvent(a[b]);this._not_render=!1,this._render_wait&&this.render_view_data(),this._loading=!1,this._after_call&&this._after_call(),this._after_call=null},scheduler._init_event=function(a){a.text=a.text||a._tagvalue||"",a.start_date=scheduler._init_date(a.start_date),a.end_date=scheduler._init_date(a.end_date)},scheduler._init_date=function(a){return a?"string"==typeof a?scheduler.templates.xml_date(a):new Date(a):null},scheduler.json={},scheduler.json.parse=function(data){"string"==typeof data&&(scheduler._temp=eval("("+data+")"),data=scheduler._temp?scheduler._temp.data||scheduler._temp.d||scheduler._temp:[]),data.dhx_security&&(dhtmlx.security_key=data.dhx_security);var collections=scheduler._temp&&scheduler._temp.collections?scheduler._temp.collections:{},collections_loaded=!1;for(var key in collections)if(collections.hasOwnProperty(key)){collections_loaded=!0;var collection=collections[key],arr=scheduler.serverList[key];if(!arr)continue;arr.splice(0,arr.length);for(var j=0;j<collection.length;j++){var option=collection[j],obj={key:option.value,label:option.label};for(var option_key in option)if(option.hasOwnProperty(option_key)){if("value"==option_key||"label"==option_key)continue;obj[option_key]=option[option_key]}arr.push(obj)}}collections_loaded&&scheduler.callEvent("onOptionsLoad",[]);for(var evs=[],i=0;i<data.length;i++){var event=data[i];scheduler._init_event(event),evs.push(event)}return evs},scheduler.parse=function(a,b){this._process=b,this.on_load({xmlDoc:{responseText:a}})},scheduler.load=function(a,b){"string"==typeof b&&(this._process=b,b=arguments[2]),this._load_url=a,this._after_call=b,this._load(a,this._date)},scheduler.setLoadMode=function(a){"all"==a&&(a=""),this._load_mode=a},scheduler.serverList=function(a,b){return b?(this.serverList[a]=b.slice(0),this.serverList[a]):(this.serverList[a]=this.serverList[a]||[],this.serverList[a])},scheduler._userdata={},scheduler._magic_parser=function(a){var b;if(!a.getXMLTopNode){var c=a.xmlDoc.responseText;a=new dtmlXMLLoaderObject(function(){}),a.loadXMLString(c)}if(b=a.getXMLTopNode("data"),"data"!=b.tagName)return null;var d=b.getAttribute("dhx_security");d&&(dhtmlx.security_key=d);for(var e=a.doXPath("//coll_options"),f=0;f<e.length;f++){var g=e[f].getAttribute("for"),h=this.serverList[g];if(h){h.splice(0,h.length);for(var i=a.doXPath(".//item",e[f]),j=0;j<i.length;j++){for(var k=i[j],l=k.attributes,m={key:i[j].getAttribute("value"),label:i[j].getAttribute("label")},n=0;n<l.length;n++){var o=l[n];"value"!=o.nodeName&&"label"!=o.nodeName&&(m[o.nodeName]=o.nodeValue)}h.push(m)}}}e.length&&scheduler.callEvent("onOptionsLoad",[]);for(var p=a.doXPath("//userdata"),f=0;f<p.length;f++){var q=this._xmlNodeToJSON(p[f]);this._userdata[q.name]=q.text}var r=[];b=a.doXPath("//event");for(var f=0;f<b.length;f++){var s=r[f]=this._xmlNodeToJSON(b[f]);scheduler._init_event(s)}return r},scheduler._xmlNodeToJSON=function(a){for(var b={},c=0;c<a.attributes.length;c++)b[a.attributes[c].name]=a.attributes[c].value;for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];1==d.nodeType&&(b[d.tagName]=d.firstChild?d.firstChild.nodeValue:"")}return b.text||(b.text=a.firstChild?a.firstChild.nodeValue:""),b},scheduler.attachEvent("onXLS",function(){if(this.config.show_loading===!0){var a;a=this.config.show_loading=document.createElement("DIV"),a.className="dhx_loading",a.style.left=Math.round((this._x-128)/2)+"px",a.style.top=Math.round((this._y-15)/2)+"px",this._obj.appendChild(a)}}),scheduler.attachEvent("onXLE",function(){var a=this.config.show_loading;a&&"object"==typeof a&&(this._obj.removeChild(a),this.config.show_loading=!0)}),scheduler.ical={parse:function(a){var b=a.match(RegExp(this.c_start+"[^\f]*"+this.c_end,""));if(b.length){b[0]=b[0].replace(/[\r\n]+(?=[a-z \t])/g," "),b[0]=b[0].replace(/\;[^:\r\n]*:/g,":");for(var c,d=[],e=RegExp("(?:"+this.e_start+")([^\f]*?)(?:"+this.e_end+")","g");null!==(c=e.exec(b));){for(var f,g={},h=/[^\r\n]+[\r\n]+/g;null!==(f=h.exec(c[1]));)this.parse_param(f.toString(),g);g.uid&&!g.id&&(g.id=g.uid),d.push(g)}return d}},parse_param:function(a,b){var c=a.indexOf(":");if(-1!=c){var d=a.substr(0,c).toLowerCase(),e=a.substr(c+1).replace(/\\\,/g,",").replace(/[\r\n]+$/,"");"summary"==d?d="text":"dtstart"==d?(d="start_date",e=this.parse_date(e,0,0)):"dtend"==d&&(d="end_date",e=this.parse_date(e,0,0)),b[d]=e}},parse_date:function(a,b,c){var d=a.split("T");d[1]&&(b=d[1].substr(0,2),c=d[1].substr(2,2));var e=d[0].substr(0,4),f=parseInt(d[0].substr(4,2),10)-1,g=d[0].substr(6,2);return scheduler.config.server_utc&&!d[1]?new Date(Date.UTC(e,f,g,b,c)):new Date(e,f,g,b,c)},c_start:"BEGIN:VCALENDAR",e_start:"BEGIN:VEVENT",e_end:"END:VEVENT",c_end:"END:VCALENDAR"},scheduler._lightbox_controls={},scheduler.formSection=function(a){var b=this.config.lightbox.sections,c=0;for(c;c<b.length&&b[c].name!=a;c++);var d=b[c];scheduler._lightbox||scheduler.getLightbox();var e=document.getElementById(d.id),f=e.nextSibling,g={section:d,header:e,node:f,getValue:function(a){return scheduler.form_blocks[d.type].get_value(f,a||{},d)},setValue:function(a,b){return scheduler.form_blocks[d.type].set_value(f,a,b||{},d)}},h=scheduler._lightbox_controls["get_"+d.type+"_control"];return h?h(g):g},scheduler._lightbox_controls.get_template_control=function(a){return a.control=a.node,a},scheduler._lightbox_controls.get_select_control=function(a){return a.control=a.node.getElementsByTagName("select")[0],a},scheduler._lightbox_controls.get_textarea_control=function(a){return a.control=a.node.getElementsByTagName("textarea")[0],a},scheduler._lightbox_controls.get_time_control=function(a){return a.control=a.node.getElementsByTagName("select"),a},scheduler.form_blocks={template:{render:function(a){var b=(a.height||"30")+"px";return"<div class='dhx_cal_ltext dhx_cal_template' style='height:"+b+";'></div>"},set_value:function(a,b){a.innerHTML=b||""},get_value:function(a){return a.innerHTML||""},focus:function(){}},textarea:{render:function(a){var b=(a.height||"130")+"px";return"<div class='dhx_cal_ltext' style='height:"+b+";'><textarea></textarea></div>"},set_value:function(a,b){a.firstChild.value=b||""},get_value:function(a){return a.firstChild.value},focus:function(a){var b=a.firstChild;scheduler._focus(b,!0)}},select:{render:function(a){for(var b=(a.height||"23")+"px",c="<div class='dhx_cal_ltext' style='height:"+b+";'><select style='width:100%;'>",d=0;d<a.options.length;d++)c+="<option value='"+a.options[d].key+"'>"+a.options[d].label+"</option>";return c+="</select></div>"},set_value:function(a,b,c,d){var e=a.firstChild;!e._dhx_onchange&&d.onchange&&(e.onchange=d.onchange,e._dhx_onchange=!0),"undefined"==typeof b&&(b=(e.options[0]||{}).value),e.value=b||""},get_value:function(a){return a.firstChild.value},focus:function(a){var b=a.firstChild;scheduler._focus(b,!0)}},time:{render:function(a){a.time_format||(a.time_format=["%H:%i","%d","%m","%Y"]),a._time_format_order={};var b=a.time_format,c=scheduler.config,d=this.date.date_part(scheduler._currentDate()),e=1440,f=0;scheduler.config.limit_time_select&&(e=60*c.last_hour+1,f=60*c.first_hour,d.setHours(c.first_hour));for(var g="",h=0;h<b.length;h++){var i=b[h];switch(h>0&&(g+=" "),i){case"%Y":a._time_format_order[3]=h,g+="<select>";for(var j=d.getFullYear()-5,k=0;10>k;k++)g+="<option value='"+(j+k)+"'>"+(j+k)+"</option>";g+="</select> ";break;case"%m":a._time_format_order[2]=h,g+="<select>";for(var k=0;12>k;k++)g+="<option value='"+k+"'>"+this.locale.date.month_full[k]+"</option>";g+="</select>";break;case"%d":a._time_format_order[1]=h,g+="<select>";for(var k=1;32>k;k++)g+="<option value='"+k+"'>"+k+"</option>";g+="</select>";break;case"%H:%i":a._time_format_order[0]=h,g+="<select>";var k=f,l=d.getDate();for(a._time_values=[];e>k;){var m=this.templates.time_picker(d);g+="<option value='"+k+"'>"+m+"</option>",a._time_values.push(k),d.setTime(d.valueOf()+60*this.config.time_step*1e3);var n=d.getDate()!=l?1:0;k=24*n*60+60*d.getHours()+d.getMinutes()}g+="</select>"}}return"<div style='height:30px;padding-top:0px;font-size:inherit;' class='dhx_section_time'>"+g+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+g+"</div>"},set_value:function(a,b,c,d){function e(a,b,c){for(var e=d._time_values,f=60*c.getHours()+c.getMinutes(),g=f,h=!1,i=0;i<e.length;i++){var k=e[i];
if(k===f){h=!0;break}f>k&&(g=k)}a[b+j[0]].value=h?f:g,h||g||(a[b+j[0]].selectedIndex=-1),a[b+j[1]].value=c.getDate(),a[b+j[2]].value=c.getMonth(),a[b+j[3]].value=c.getFullYear()}var f,g,h=scheduler.config,i=a.getElementsByTagName("select"),j=d._time_format_order;if(h.full_day){if(!a._full_day){var k="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"&nbsp;</label></input>";scheduler.config.wide_form||(k=a.previousSibling.innerHTML+k),a.previousSibling.innerHTML=k,a._full_day=!0}var l=a.previousSibling.getElementsByTagName("input")[0];l.checked=0===scheduler.date.time_part(c.start_date)&&0===scheduler.date.time_part(c.end_date),i[j[0]].disabled=l.checked,i[j[0]+i.length/2].disabled=l.checked,l.onclick=function(){if(l.checked){var b={};scheduler.form_blocks.time.get_value(a,b,d),f=scheduler.date.date_part(b.start_date),g=scheduler.date.date_part(b.end_date),(+g==+f||+g>=+f&&(0!==c.end_date.getHours()||0!==c.end_date.getMinutes()))&&(g=scheduler.date.add(g,1,"day"))}i[j[0]].disabled=l.checked,i[j[0]+i.length/2].disabled=l.checked,e(i,0,f||c.start_date),e(i,4,g||c.end_date)}}if(h.auto_end_date&&h.event_duration)for(var m=function(){f=new Date(i[j[3]].value,i[j[2]].value,i[j[1]].value,0,i[j[0]].value),g=new Date(f.getTime()+60*scheduler.config.event_duration*1e3),e(i,4,g)},n=0;4>n;n++)i[n].onchange=m;e(i,0,c.start_date),e(i,4,c.end_date)},get_value:function(a,b,c){var d=a.getElementsByTagName("select"),e=c._time_format_order;return b.start_date=new Date(d[e[3]].value,d[e[2]].value,d[e[1]].value,0,d[e[0]].value),b.end_date=new Date(d[e[3]+4].value,d[e[2]+4].value,d[e[1]+4].value,0,d[e[0]+4].value),b.end_date<=b.start_date&&(b.end_date=scheduler.date.add(b.start_date,scheduler.config.time_step,"minute")),{start_date:new Date(b.start_date),end_date:new Date(b.end_date)}},focus:function(a){scheduler._focus(a.getElementsByTagName("select")[0])}}},scheduler.showCover=function(a){if(a){a.style.display="block";var b=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,c=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,d=window.innerHeight||document.documentElement.clientHeight;a.style.top=b?Math.round(b+Math.max((d-a.offsetHeight)/2,0))+"px":Math.round(Math.max((d-a.offsetHeight)/2,0)+9)+"px",a.style.left=document.documentElement.scrollWidth>document.body.offsetWidth?Math.round(c+(document.body.offsetWidth-a.offsetWidth)/2)+"px":Math.round((document.body.offsetWidth-a.offsetWidth)/2)+"px"}this.show_cover()},scheduler.showLightbox=function(a){if(a){if(!this.callEvent("onBeforeLightbox",[a]))return void(this._new_event&&(this._new_event=null));var b=this.getLightbox();this.showCover(b),this._fill_lightbox(a,b),this.callEvent("onLightbox",[a])}},scheduler._fill_lightbox=function(a,b){var c=this.getEvent(a),d=b.getElementsByTagName("span");scheduler.templates.lightbox_header?(d[1].innerHTML="",d[2].innerHTML=scheduler.templates.lightbox_header(c.start_date,c.end_date,c)):(d[1].innerHTML=this.templates.event_header(c.start_date,c.end_date,c),d[2].innerHTML=(this.templates.event_bar_text(c.start_date,c.end_date,c)||"").substr(0,70));for(var e=this.config.lightbox.sections,f=0;f<e.length;f++){var g=e[f],h=document.getElementById(g.id).nextSibling,i=this.form_blocks[g.type],j=void 0!==c[g.map_to]?c[g.map_to]:g.default_value;i.set_value.call(this,h,j,c,g),e[f].focus&&i.focus.call(this,h)}scheduler._lightbox_id=a},scheduler._lightbox_out=function(a){for(var b=this.config.lightbox.sections,c=0;c<b.length;c++){var d=document.getElementById(b[c].id);d=d?d.nextSibling:d;var e=this.form_blocks[b[c].type],f=e.get_value.call(this,d,a,b[c]);"auto"!=b[c].map_to&&(a[b[c].map_to]=f)}return a},scheduler._empty_lightbox=function(a){{var b=scheduler._lightbox_id,c=this.getEvent(b);this.getLightbox()}this._lame_copy(c,a),this.setEvent(c.id,c),this._edit_stop_event(c,!0),this.render_view_data()},scheduler.hide_lightbox=function(){this.hideCover(this.getLightbox()),this._lightbox_id=null,this.callEvent("onAfterLightbox",[])},scheduler.hideCover=function(a){a&&(a.style.display="none"),this.hide_cover()},scheduler.hide_cover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover),this._cover=null},scheduler.show_cover=function(){if(!this._cover){this._cover=document.createElement("DIV"),this._cover.className="dhx_cal_cover";var a=void 0!==document.height?document.height:document.body.offsetHeight,b=document.documentElement?document.documentElement.scrollHeight:0;this._cover.style.height=Math.max(a,b)+"px",document.body.appendChild(this._cover)}},scheduler.save_lightbox=function(){var a=this._lightbox_out({},this._lame_copy(this.getEvent(this._lightbox_id)));(!this.checkEvent("onEventSave")||this.callEvent("onEventSave",[this._lightbox_id,a,this._new_event]))&&(this._empty_lightbox(a),this.hide_lightbox())},scheduler.startLightbox=function(a,b){this._lightbox_id=a,this._custom_lightbox=!0,this._temp_lightbox=this._lightbox,this._lightbox=b,this.showCover(b)},scheduler.endLightbox=function(a,b){this._edit_stop_event(scheduler.getEvent(this._lightbox_id),a),a&&scheduler.render_view_data(),this.hideCover(b),this._custom_lightbox&&(this._lightbox=this._temp_lightbox,this._custom_lightbox=!1),this._temp_lightbox=this._lightbox_id=null},scheduler.resetLightbox=function(){scheduler._lightbox&&!scheduler._custom_lightbox&&scheduler._lightbox.parentNode.removeChild(scheduler._lightbox),scheduler._lightbox=null},scheduler.cancel_lightbox=function(){this.callEvent("onEventCancel",[this._lightbox_id,this._new_event]),this.endLightbox(!1),this.hide_lightbox()},scheduler._init_lightbox_events=function(){this.getLightbox().onclick=function(a){var b=a?a.target:event.srcElement;if(b.className||(b=b.previousSibling),b&&b.className)switch(b.className){case"dhx_save_btn":scheduler.save_lightbox();break;case"dhx_delete_btn":var c=scheduler.locale.labels.confirm_deleting;scheduler._dhtmlx_confirm(c,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(scheduler._lightbox_id),scheduler._new_event=null,scheduler.hide_lightbox()});break;case"dhx_cancel_btn":scheduler.cancel_lightbox();break;default:if(b.getAttribute("dhx_button"))scheduler.callEvent("onLightboxButton",[b.className,b,a]);else{var d,e,f;-1!=b.className.indexOf("dhx_custom_button")&&(-1!=b.className.indexOf("dhx_custom_button_")?(d=b.parentNode.getAttribute("index"),f=b.parentNode.parentNode):(d=b.getAttribute("index"),f=b.parentNode,b=b.firstChild)),d&&(e=scheduler.form_blocks[scheduler.config.lightbox.sections[d].type],e.button_click(d,b,f,f.nextSibling))}}},this.getLightbox().onkeydown=function(a){switch((a||event).keyCode){case scheduler.keys.edit_save:if((a||event).shiftKey)return;scheduler.save_lightbox();break;case scheduler.keys.edit_cancel:scheduler.cancel_lightbox()}}},scheduler.setLightboxSize=function(){var a=this._lightbox;if(a){var b=a.childNodes[1];b.style.height="0px",b.style.height=b.scrollHeight+"px",a.style.height=b.scrollHeight+scheduler.xy.lightbox_additional_height+"px",b.style.height=b.scrollHeight+"px"}},scheduler._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",scheduler._move_while_dnd),dhtmlxEvent(document.body,"mouseup",scheduler._finish_dnd),scheduler._init_dnd_events=function(){}},scheduler._move_while_dnd=function(a){if(scheduler._dnd_start_lb){document.dhx_unselectable||(document.body.className+=" dhx_unselectable",document.dhx_unselectable=!0);var b=scheduler.getLightbox(),c=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY];b.style.top=scheduler._lb_start[1]+c[1]-scheduler._dnd_start_lb[1]+"px",b.style.left=scheduler._lb_start[0]+c[0]-scheduler._dnd_start_lb[0]+"px"}},scheduler._ready_to_dnd=function(a){var b=scheduler.getLightbox();scheduler._lb_start=[parseInt(b.style.left,10),parseInt(b.style.top,10)],scheduler._dnd_start_lb=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY]},scheduler._finish_dnd=function(){scheduler._lb_start&&(scheduler._lb_start=scheduler._dnd_start_lb=!1,document.body.className=document.body.className.replace(" dhx_unselectable",""),document.dhx_unselectable=!1)},scheduler.getLightbox=function(){if(!this._lightbox){var a=document.createElement("DIV");a.className="dhx_cal_light",scheduler.config.wide_form&&(a.className+=" dhx_cal_light_wide"),scheduler.form_blocks.recurring&&(a.className+=" dhx_cal_light_rec"),/msie|MSIE 6/.test(navigator.userAgent)&&(a.className+=" dhx_ie6"),a.style.visibility="hidden";for(var b=this._lightbox_template,c=this.config.buttons_left,d=0;d<c.length;d++)b+="<div class='dhx_btn_set dhx_left_btn_set "+c[d]+"_set'><div dhx_button='1' class='"+c[d]+"'></div><div>"+scheduler.locale.labels[c[d]]+"</div></div>";c=this.config.buttons_right;for(var d=0;d<c.length;d++)b+="<div class='dhx_btn_set dhx_right_btn_set "+c[d]+"_set' style='float:right;'><div dhx_button='1' class='"+c[d]+"'></div><div>"+scheduler.locale.labels[c[d]]+"</div></div>";b+="</div>",a.innerHTML=b,scheduler.config.drag_lightbox&&(a.firstChild.onmousedown=scheduler._ready_to_dnd,a.firstChild.onselectstart=function(){return!1},a.firstChild.style.cursor="pointer",scheduler._init_dnd_events()),document.body.insertBefore(a,document.body.firstChild),this._lightbox=a;var e=this.config.lightbox.sections;b="";for(var d=0;d<e.length;d++){var f=this.form_blocks[e[d].type];if(f){e[d].id="area_"+this.uid();var g="";e[d].button&&(g="<div class='dhx_custom_button' index='"+d+"'><div class='dhx_custom_button_"+e[d].button+"'></div><div>"+this.locale.labels["button_"+e[d].button]+"</div></div>"),this.config.wide_form&&(b+="<div class='dhx_wrap_section'>");var h=this.locale.labels["section_"+e[d].name];"string"!=typeof h&&(h=e[d].name),b+="<div id='"+e[d].id+"' class='dhx_cal_lsection'>"+g+h+"</div>"+f.render.call(this,e[d]),b+="</div>"}}for(var i=a.getElementsByTagName("div"),d=0;d<i.length;d++){var j=i[d];if("dhx_cal_larea"==j.className){j.innerHTML=b;break}}this.setLightboxSize(),this._init_lightbox_events(this),a.style.display="none",a.style.visibility="visible"}return this._lightbox},scheduler.attachEvent("onEventIdChange",function(a,b){this._lightbox_id==a&&(this._lightbox_id=b)}),scheduler._lightbox_template="<div class='dhx_cal_ltitle'><span class='dhx_mark'>&nbsp;</span><span class='dhx_time'></span><span class='dhx_title'></span></div><div class='dhx_cal_larea'></div>",scheduler._init_touch_events=function(){"force"!=this.config.touch&&(this.config.touch=this.config.touch&&(-1!=navigator.userAgent.indexOf("Mobile")||-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("Touch"))),this.config.touch&&(this.xy.scroll_width=0,window.navigator.msPointerEnabled?(this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(a){return a.pointerType==a.MSPOINTER_TYPE_MOUSE?null:a},function(a){return!a||a.pointerType==a.MSPOINTER_TYPE_MOUSE}),this._obj.ondblclick=function(){}):this._touch_events(["touchmove","touchstart","touchend"],function(a){return a.touches&&a.touches.length>1?null:a.touches[0]?{target:a.target,pageX:a.touches[0].pageX,pageY:a.touches[0].pageY}:a},function(){return!1}))},scheduler._touch_events=function(a,b,c){function d(a,b,c){dhtmlxEvent(a,b,function(a){return scheduler._is_lightbox_open()?!0:c(a)})}function e(a,b,c){if(a&&b){var d=Math.abs(a.pageY-b.pageY),e=Math.abs(a.pageX-b.pageX);e>c&&(!d||e/d>3)&&(a.pageX>b.pageX?scheduler._click.dhx_cal_next_button():scheduler._click.dhx_cal_prev_button())}}function f(a){scheduler._hide_global_tip(),j&&(scheduler._on_mouse_up(b(a||event)),scheduler._temp_touch_block=!1),scheduler._drag_id=null,scheduler._drag_mode=null,scheduler._drag_pos=null,clearTimeout(i),j=l=!1,k=!0}var g,h,i,j,k,l,m=-1!=navigator.userAgent.indexOf("Android")&&-1!=navigator.userAgent.indexOf("WebKit"),n=0;d(document.body,a[0],function(a){if(!c(a)){if(j)return scheduler._on_mouse_move(b(a)),scheduler._update_global_tip(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,!1;if(h&&m&&e(h,b(a),0),h=b(a),l)return h?void((g.target!=h.target||Math.abs(g.pageX-h.pageX)>5||Math.abs(g.pageY-h.pageY)>5)&&(k=!0,clearTimeout(i))):void(k=!0)}}),d(this._els.dhx_cal_data[0],"scroll",f),d(this._els.dhx_cal_data[0],"touchcancel",f),d(this._els.dhx_cal_data[0],"contextmenu",function(a){return l?(a&&a.preventDefault&&a.preventDefault(),(a||event).cancelBubble=!0,!1):void 0}),d(this._els.dhx_cal_data[0],a[1],function(a){if(!c(a)){var d;if(j=k=!1,l=!0,scheduler._temp_touch_block=!0,d=h=b(a),!d)return void(k=!0);var e=new Date;if(!k&&!j&&250>e-n)return scheduler._click.dhx_cal_data(d),window.setTimeout(function(){scheduler._on_dbl_click(d)},50),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,scheduler._block_next_stop=!0,!1;n=e,k||j||!scheduler.config.touch_drag||(i=setTimeout(function(){j=!0;var a=g.target;if(a&&a.className&&-1!=a.className.indexOf("dhx_body")&&(a=a.previousSibling),scheduler._on_mouse_down(g,a),scheduler._drag_mode&&"create"!=scheduler._drag_mode){var b=-1;if(scheduler.for_rendered(scheduler._drag_id,function(a,c){b=a.getBoundingClientRect().top,a.style.display="none",scheduler._rendered.splice(c,1)}),b>=0){var c=scheduler.config.time_step;scheduler._move_pos_shift=c*Math.round(60*(d.pageY-b)/(scheduler.config.hour_size_px*c))}}scheduler.config.touch_tip&&scheduler._show_global_tip(),scheduler._on_mouse_move(g)},scheduler.config.touch_drag),g=d)}}),d(this._els.dhx_cal_data[0],a[2],function(a){return c(a)?void 0:(j||e(g,h,200),j&&(scheduler._ignore_next_click=!0),f(a),scheduler._block_next_stop?(scheduler._block_next_stop=!1,a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,!1):void 0)}),dhtmlxEvent(document.body,a[2],f)},scheduler._show_global_tip=function(){scheduler._hide_global_tip();var a=scheduler._global_tip=document.createElement("DIV");a.className="dhx_global_tip",scheduler._update_global_tip(1),document.body.appendChild(a)},scheduler._update_global_tip=function(a){var b=scheduler._global_tip;if(b){var c="";if(scheduler._drag_id&&!a){var d=scheduler.getEvent(scheduler._drag_id);d&&(c="<div>"+(d._timed?scheduler.templates.event_header(d.start_date,d.end_date,d):scheduler.templates.day_date(d.start_date,d.end_date,d))+"</div>")}b.innerHTML="create"==scheduler._drag_mode||"new-size"==scheduler._drag_mode?(scheduler.locale.drag_to_create||"Drag to create")+c:(scheduler.locale.drag_to_move||"Drag to move")+c}},scheduler._hide_global_tip=function(){var a=scheduler._global_tip;a&&a.parentNode&&(a.parentNode.removeChild(a),scheduler._global_tip=0)},scheduler._dp_init=function(a){a._methods=["_set_event_text_style","","changeEventId","_dp_hook_delete"],this._dp_hook_delete=function(a){return this.deleteEvent(a,!0)},this.attachEvent("onEventAdded",function(b){!this._loading&&this._validId(b)&&a.setUpdated(b,!0,"inserted")}),this.attachEvent("onConfirmedBeforeEventDelete",function(b){if(this._validId(b)){var c=a.getState(b);return"inserted"==c||this._new_event?(a.setUpdated(b,!1),!0):"deleted"==c?!1:"true_deleted"==c?!0:(a.setUpdated(b,!0,"deleted"),!1)}}),this.attachEvent("onEventChanged",function(b){!this._loading&&this._validId(b)&&a.setUpdated(b,!0,"updated")}),a._getRowData=function(a){var b=this.obj.getEvent(a),c={};for(var d in b)0!==d.indexOf("_")&&(c[d]=b[d]&&b[d].getUTCFullYear?this.obj.templates.xml_format(b[d]):b[d]);return c},a._clearUpdateFlag=function(){},a.attachEvent("insertCallback",scheduler._update_callback),a.attachEvent("updateCallback",scheduler._update_callback),a.attachEvent("deleteCallback",function(a,b){this.obj.setUserData(b,this.action_param,"true_deleted"),this.obj.deleteEvent(b)})},scheduler._validId=function(){return!0},scheduler.setUserData=function(a,b,c){a?this.getEvent(a)[b]=c:this._userdata[b]=c},scheduler.getUserData=function(a,b){return a?this.getEvent(a)[b]:this._userdata[b]},scheduler._set_event_text_style=function(a,b){this.for_rendered(a,function(a){a.style.cssText+=";"+b});var c=this.getEvent(a);c._text_style=b,this.event_updated(c)},scheduler._update_callback=function(a){var b=scheduler._xmlNodeToJSON(a.firstChild);b.text=b.text||b._tagvalue,b.start_date=scheduler.templates.xml_date(b.start_date),b.end_date=scheduler.templates.xml_date(b.end_date),scheduler.addEvent(b)},scheduler._skin_settings={fix_tab_position:[1,0],use_select_menu_space:[1,0],wide_form:[1,0],hour_size_px:[44,42],displayed_event_color:["#ff4a4a","ffc5ab"],displayed_event_text_color:["#ffef80","7e2727"]},scheduler._skin_xy={lightbox_additional_height:[90,50],nav_height:[59,22],bar_height:[24,20]},scheduler._configure=function(a,b,c){for(var d in b)"undefined"==typeof a[d]&&(a[d]=b[d][c])},scheduler._skin_init=function(){if(!scheduler.skin)for(var a=document.getElementsByTagName("link"),b=0;b<a.length;b++){var c=a[b].href.match("dhtmlxscheduler_([a-z]+).css");if(c){scheduler.skin=c[1];break}}var d=0;if(!scheduler.skin||"classic"!==scheduler.skin&&"glossy"!==scheduler.skin||(d=1),this._configure(scheduler.config,scheduler._skin_settings,d),this._configure(scheduler.xy,scheduler._skin_xy,d),!d){var e=scheduler.config.minicalendar;e&&(e.padding=14),scheduler.templates.event_bar_date=function(a){return" <b>"+scheduler.templates.event_date(a)+"</b> "},scheduler.attachEvent("onTemplatesReady",function(){var a=scheduler.date.date_to_str("%d");scheduler.templates._old_month_day||(scheduler.templates._old_month_day=scheduler.templates.month_day);var b=scheduler.templates._old_month_day;if(scheduler.templates.month_day=function(c){if("month"==this._mode){var d=a(c);return 1==c.getDate()&&(d=scheduler.locale.date.month_full[c.getMonth()]+" "+d),+c==+scheduler.date.date_part(new Date)&&(d=scheduler.locale.labels.dhx_cal_today_button+" "+d),d}return b.call(this,c)},scheduler.config.fix_tab_position){for(var c=scheduler._els.dhx_cal_navline[0].getElementsByTagName("div"),d=null,e=211,f=0;f<c.length;f++){var g=c[f],h=g.getAttribute("name");if(h)switch(g.style.right="auto",h){case"day_tab":g.style.left="14px",g.className+=" dhx_cal_tab_first";break;case"week_tab":g.style.left="75px";break;case"month_tab":g.style.left="136px",g.className+=" dhx_cal_tab_last";break;default:g.style.left=e+"px",g.className+=" dhx_cal_tab_standalone",e=e+14+g.offsetWidth}else 0===(g.className||"").indexOf("dhx_minical_icon")&&g.parentNode==scheduler._els.dhx_cal_navline[0]&&(d=g)}d&&(d.style.left=e+"px")}scheduler.skin&&"flat"===scheduler.skin&&(scheduler.xy.scale_height=35,scheduler.templates.hour_scale=function(a){var b=a.getMinutes();b=10>b?"0"+b:b;var c="<span class='dhx_scale_h'>"+a.getHours()+"</span><span class='dhx_scale_m'>&nbsp;"+b+"</span>";return c})}),scheduler._skin_init=function(){}}},window.jQuery&&!function(a){var b=[];a.fn.dhx_scheduler=function(c){if("string"!=typeof c){var d=[];return this.each(function(){if(this&&this.getAttribute&&!this.getAttribute("dhxscheduler")){for(var a in c)"data"!=a&&(scheduler.config[a]=c[a]);this.getElementsByTagName("div").length||(this.innerHTML='<div class="dhx_cal_navline"><div class="dhx_cal_prev_button">&nbsp;</div><div class="dhx_cal_next_button">&nbsp;</div><div class="dhx_cal_today_button"></div><div class="dhx_cal_date"></div><div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div><div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div><div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div></div><div class="dhx_cal_header"></div><div class="dhx_cal_data"></div>',this.className+=" dhx_cal_container"),scheduler.init(this,scheduler.config.date,scheduler.config.mode),c.data&&scheduler.parse(c.data),d.push(scheduler)}}),1===d.length?d[0]:d}return b[c]?b[c].apply(this,[]):void a.error("Method "+c+" does not exist on jQuery.dhx_scheduler")}}(jQuery),function(){function a(a,b,c){b&&(a._date=b),c&&(a._mode=c)}var b=scheduler.setCurrentView,c=scheduler.updateView,d=null,e=null,f=function(b,f){var g=this;window.clearTimeout(e),window.clearTimeout(d),a(this,b,f),e=setTimeout(function(){g.callEvent("onBeforeViewChange",[g._mode,g._date,f||g._mode,b||g._date])&&(c.call(g,b,f),g.callEvent("onViewChange",[g._mode,g._date]),window.clearTimeout(d),e=0)},scheduler.config.delay_render)},g=function(b,f){var g=this,h=arguments;a(this,b,f),window.clearTimeout(d),d=setTimeout(function(){e||c.apply(g,h)},scheduler.config.delay_render)};scheduler.attachEvent("onSchedulerReady",function(){scheduler.config.delay_render?(scheduler.setCurrentView=f,scheduler.updateView=g):(scheduler.setCurrentView=b,scheduler.updateView=c)})}();
//# sourceMappingURL=dhtmlxscheduler-min.map